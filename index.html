<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="HRBP 업무 스타일 진단 테스트 — 22문항으로 알아보는 나의 HRBP 유형, 플레이버, 과업 적합도, 팀 조합 분석">
<meta property="og:title" content="나는 어떤 HRBP일까?">
<meta property="og:description" content="HRBP 업무 스타일 진단 · 22문항 · 약 5분 · 36가지 프로필">
<title>나는 어떤 HRBP일까?</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Pretendard',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(160deg,#FAFBFF 0%,#F0EDFF 40%,#E8F4FD 70%,#FFF5F2 100%);min-height:100vh;color:#1A1A2E}
.wrap{display:flex;flex-direction:column;align-items:center;padding:20px;min-height:100vh}
.container{max-width:540px;width:100%}
.card{background:#fff;border-radius:20px;padding:24px;box-shadow:0 4px 20px rgba(0,0,0,.05);margin-bottom:16px}
.card-bordered{border:2px solid var(--c)}
.sec-title{font-size:13px;font-weight:700;color:#9CA3AF;letter-spacing:.5px;margin-bottom:14px;text-transform:uppercase}
.tag{font-size:13px;padding:7px 12px;border-radius:10px;display:inline-block;margin:0 6px 6px 0}
.tag-green{background:#F0FDF4;color:#166534;border:1px solid #BBF7D0}
.tag-red{background:#FEF2F2;color:#991B1B;border:1px solid #FECACA}
.btn{width:100%;padding:16px;font-size:15px;font-weight:700;border:none;border-radius:14px;cursor:pointer;transition:all .2s;font-family:inherit}
.btn-primary{color:#fff;background:linear-gradient(135deg,#6C5CE7,#0984E3);box-shadow:0 4px 16px rgba(108,92,231,.3)}
.btn-secondary{color:#6C5CE7;background:#fff;border:2px solid #E5E7EB}
.btn:active{transform:scale(.98)}
.input{width:100%;padding:12px 14px;font-size:14px;border:2px solid #E5E7EB;border-radius:12px;outline:none;font-family:inherit;transition:border .2s}
.input:focus{border-color:#6C5CE7}
.fade-in{opacity:0;transform:translateY(16px);animation:fadeUp .6s cubic-bezier(.16,1,.3,1) forwards}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
.hidden{display:none!important}

/* Chart */
.chart-wrap{position:relative;width:100%;padding-bottom:100%;max-width:300px;margin:0 auto;background:#F9FAFB;border-radius:16px;overflow:hidden}
.chart-wrap .axis-h{position:absolute;top:50%;left:0;right:0;height:1px;background:#E5E7EB}
.chart-wrap .axis-v{position:absolute;left:50%;top:0;bottom:0;width:1px;background:#E5E7EB}
.chart-label{position:absolute;font-size:10px;font-weight:600;color:#9CA3AF}
.chart-quad{position:absolute;font-size:10px;font-weight:600;text-align:center;opacity:.4}
.dot{position:absolute;transform:translate(-50%,-50%);z-index:10;display:flex;flex-direction:column;align-items:center}
.dot-circle{width:14px;height:14px;border-radius:50%}
.dot-name{font-size:9px;font-weight:700;margin-top:3px;background:#fff;padding:1px 5px;border-radius:4px;box-shadow:0 1px 4px rgba(0,0,0,.1);white-space:nowrap}

/* Scale buttons */
.scale-row{display:flex;align-items:center;justify-content:center;gap:0;padding:12px 0}
.scale-btn{border-radius:50%;border:3px solid #E5E7EB;cursor:pointer;transition:all .15s;background:#F3F4F6;flex-shrink:0}
.scale-btn:hover{transform:scale(1.1)}
.scale-btn.selected{transform:scale(1.15)}
.scale-label{font-size:10px;margin-top:6px;color:#9CA3AF;text-align:center;font-weight:400}
.scale-col{display:flex;flex-direction:column;align-items:center;flex:1}

/* Toast & Spinner */
@keyframes spin{to{transform:rotate(360deg)}}
.spinner{width:24px;height:24px;border:3px solid #E5E7EB;border-top-color:#6C5CE7;border-radius:50%;animation:spin .8s linear infinite;display:inline-block}
#toast{font-family:'Pretendard',sans-serif}

/* Responsive */
@media(max-width:400px){.card{padding:18px}.container{padding:0 4px}}
</style>
</head>
<body>
<div class="wrap">
<div class="container" id="app"></div>
</div>

<script>
/* ===== DATA ===== */
const QUESTIONS = [
  // SE axis (Strategy- / Execution+)
  {axis:"SE",rev:false,text:"새로운 프로젝트가 시작됐을 때, 나는 먼저...",a:"이 프로젝트의 방향과 목적부터 정리한다",b:"실행 계획과 일정부터 짠다"},
  {axis:"SE",rev:false,text:"담당 조직에서 갑자기 이슈가 터졌을 때...",a:"근본 원인과 구조적 문제를 먼저 파악한다",b:"당장 해결 가능한 것부터 빠르게 처리한다"},
  {axis:"SE",rev:true,text:"팀 회의에서 더 집중하게 되는 안건은?",a:"이번 주 각자 할 일과 진행 상황 체크",b:"우리 팀의 중장기 방향성과 역할 논의"},
  {axis:"SE",rev:false,text:"'오늘 일을 잘 했다'고 느끼는 순간은?",a:"새로운 관점이나 해결 프레임을 제시했을 때",b:"계획한 일을 차질 없이 마무리했을 때"},
  {axis:"SE",rev:true,text:"보고서를 쓸 때 먼저 손이 가는 건?",a:"데이터 수집과 팩트 정리부터",b:"전체 메시지와 스토리라인 구성부터"},
  {axis:"SE",rev:false,text:"상사에게 보고할 때 더 자연스러운 방식은?",a:"'왜(Why)' 이걸 해야 하는지 맥락 중심으로",b:"'무엇(What)'을 했고 어디까지 됐는지 중심으로"},
  {axis:"SE",rev:true,text:"업무 관련 세미나를 고른다면?",a:"실무 노하우, 최신 툴 활용법",b:"경영 전략, 조직 설계 트렌드"},
  {axis:"SE",rev:false,text:"후배가 고민 상담을 하면 주로 해주는 말은?",a:"한 발 물러서서 큰 그림을 먼저 그려봐",b:"일단 할 수 있는 것부터 하나씩 시작해봐"},
  // PT axis (People- / Task+)
  {axis:"PT",rev:false,text:"BP 역할에서 가장 보람을 느끼는 순간은?",a:"구성원이 성장하거나 조직 분위기가 좋아질 때",b:"프로세스가 개선되고 효율이 눈에 띄게 올라갈 때"},
  {axis:"PT",rev:true,text:"조직 변화를 추진할 때 먼저 하는 것은?",a:"변화의 필요성과 논리적 근거를 정리한다",b:"구성원들이 어떻게 받아들일지 반응을 살핀다"},
  {axis:"PT",rev:false,text:"채용 면접에서 더 신경 쓰이는 건?",a:"이 사람이 우리 팀과 잘 어울릴 수 있을지",b:"이 사람이 실제 업무를 잘 해낼 수 있을지"},
  {axis:"PT",rev:false,text:"현업 리더와 미팅할 때 나는...",a:"리더의 고민과 맥락을 먼저 충분히 듣는다",b:"데이터와 현황을 먼저 공유하고 논의를 시작한다"},
  {axis:"PT",rev:true,text:"업무 중 가장 의미있게 느끼는 시간은?",a:"혼자 집중해서 업무를 깊이 처리하는 시간",b:"사람들과 대화하며 관계를 쌓는 시간"},
  {axis:"PT",rev:false,text:"동료가 업무로 힘들어할 때 나는...",a:"먼저 다가가서 이야기를 들어준다",b:"도움이 될 만한 해결책이나 자료를 찾아준다"},
  {axis:"PT",rev:true,text:"프로젝트 성공의 핵심은 무엇이라고 생각해?",a:"체계적인 프로세스와 명확한 기준",b:"구성원들의 몰입과 동기부여"},
  {axis:"PT",rev:false,text:"팀에서 내 역할이 인정받을 때 더 뿌듯한 건?",a:"사람들이 나를 믿고 의지할 때",b:"내가 만든 결과물이나 시스템이 잘 작동할 때"},
];

const STRENGTH_QUESTIONS = [
  // CS axis: 변화(Change, a=-) ↔ 안정(Stability, b=+)
  {axis:"CS",text:"조직에 새로운 변화가 필요하다는 이야기가 나왔을 때, 나는...",
    a:"먼저 변화의 가능성에 설레고, 새로운 방법을 시도하고 싶어진다",
    b:"변화의 리스크를 먼저 따지고, 기존에 잘 되고 있는 것을 지키고 싶다"},
  {axis:"CS",text:"새로운 HR 트렌드나 툴이 등장했을 때?",
    a:"일단 써보고 싶다 — 직접 해봐야 감이 오니까",
    b:"검증된 사례를 먼저 확인한다 — 괜히 바꿨다가 혼란만 생길 수 있으니까"},
  {axis:"CS",text:"내가 더 편한 업무 환경은?",
    a:"매번 새로운 프로젝트, 새로운 도전이 있는 환경",
    b:"예측 가능하고, 안정적으로 성과를 쌓을 수 있는 환경"},
  // DI axis: 데이터(Data, a=-) ↔ 직관(Intuition, b=+)
  {axis:"DI",text:"중요한 의사결정을 해야 할 때, 나는 주로...",
    a:"관련 데이터와 수치를 먼저 확인하고 근거를 만든다",
    b:"경험과 직관으로 방향을 잡고, 필요하면 데이터를 보완한다"},
  {axis:"DI",text:"팀에서 '이 사람 곧 퇴사할 것 같다'는 이야기가 나왔을 때?",
    a:"퇴직률 데이터, 만족도 서베이 결과부터 확인한다",
    b:"평소 그 사람의 표정, 태도 변화를 떠올리며 감을 잡는다"},
  {axis:"DI",text:"경영진에게 HR 이니셔티브를 제안할 때, 더 자연스러운 건?",
    a:"수치와 벤치마크 데이터로 논리적으로 설득한다",
    b:"현장 스토리와 사례로 공감을 이끌어내며 설득한다"},
];

const T = {
  architect:{name:"조직 설계자",emoji:"🏛️",code:"A",
    subtitle:"큰 그림을 그리며 사람의 마음을 움직이는 BP",
    color:"#6C5CE7",colorLight:"#A29BFE",colorBg:"#F3F0FF",
    coreNeed:"'이 일이 왜 필요한지' 납득이 되어야 움직일 수 있어요. 방향이 명확해야 에너지가 나고, 그 방향에 사람이 빠져 있으면 찝찝해요.",
    desc:"회의 중에 갑자기 '잠깐, 근본적으로 이게 왜 필요하죠?'라고 끊는 사람. 다들 실행 이야기를 하고 있는데 혼자 방향성을 되짚고 있다면, 이 유형이에요.\n\n조직 개편안을 받으면 구조도부터 보는 게 아니라, '이 변화로 구성원들이 뭘 느끼게 될까?'를 먼저 생각해요. 전략적으로 사고하면서도 항상 사람을 중심에 두는 — Why와 Who를 동시에 붙잡으려는 사람이에요.",
    painPoint:"맥락 없이 떨어지는 지시. '그냥 해'라는 말을 들으면 속에서 뭔가 올라와요. 그리고 공들여 만든 방향성이 실행도 안 해보고 뒤집힐 때 — 그때 진짜 힘들어요.",
    flavor:{
      "C-D-":{name:"혁신 설계자",desc:"큰 그림을 그리며 사람을 챙기는 전략가인데, 새로운 변화를 데이터로 밀어요. '왜 바꿔야 하는지'를 수치로 증명하면서도 구성원 마음을 놓치지 않아요. 경영진에겐 근거로, 구성원에겐 공감으로 — 변화의 양쪽 문을 동시에 여는 사람.",strength:"데이터 기반 변화 설계 — 근거 있는 비전으로 저항을 줄이면서 사람도 챙겨요",caution:"모든 걸 증명하려다 속도가 느려질 수 있어요. 80% 근거면 일단 움직이세요"},
      "C-D+":{name:"비전 아키텍트",desc:"큰 그림과 사람을 동시에 보는 전략가인데, 직관으로 미래를 읽고 변화를 이끌어요. 남들이 아직 못 보는 가능성을 포착하고, 스토리로 사람을 움직여요. '이렇게 하면 어떨까?'라는 영감이 먼저 오고, 그 방향에 사람들이 따라오게 만드는 사람.",strength:"비전 + 스토리텔링 — 사람들이 '가고 싶다'고 느끼는 방향을 만들어요",caution:"직관만 앞서면 '근거가 부족하다'는 피드백을 받기 쉬워요. 중요한 제안엔 숫자를 곁들이세요"},
      "C+D-":{name:"신중한 설계자",desc:"큰 그림을 보며 사람을 챙기는 전략가인데, 안정적 기반 위에서 데이터로 다듬어요. 급격한 변화보다 점진적 개선을 선호하고, 모든 제안에 철저한 근거를 갖춰요. 조직이 흔들릴 때 '우리 방향은 맞아, 데이터가 말해주고 있어'라고 안심시키는 사람.",strength:"리스크 관리 + 데이터 기반 의사결정 — 안정적이면서도 방향감이 있어요",caution:"너무 신중해서 타이밍을 놓칠 수 있어요. 변화가 필요한 순간엔 과감해지세요"},
      "C+D+":{name:"조직 수호자",desc:"큰 그림과 사람을 동시에 보면서, 오래 쌓인 경험과 직관으로 조직을 돌봐요. '이건 안 될 거야', '저 사람 지금 힘들어'를 정확히 읽어요. 조직의 온도를 지키면서 큰 방향도 놓치지 않는 — 팀에서 가장 든든한 존재.",strength:"경험 기반 통찰 + 조직 안정화 — 흔들리지 않는 판단력으로 팀을 지켜요",caution:"'예전에 안 됐는데'를 너무 자주 꺼내면 변화를 막는 사람이 될 수 있어요"}
    },
    keywords:["방향성 설정","변화 관리","이해관계자 설득","조직 설계","비전 수립"],
    energyUp:["채용 브랜딩 전략 기획","조직문화 진단 및 개선 설계","리더 코칭·이해관계자 설득","인재 육성 로드맵 수립","조직 개편·변화 관리 설계"],
    energyDown:["반복적인 서류 처리·데이터 입력","단순 일정 조율·행정 업무","정해진 틀대로만 실행하는 운영 업무","디테일한 숫자 검증·리포트 포맷팅"],
    manual:{
      request:"일의 배경과 '왜 이걸 해야 하는지'를 먼저 설명해주세요. 의미를 느껴야 에너지가 나는 타입이에요.",
      feedback:"방향성에 대한 피드백을 먼저 주고, 디테일은 그 다음에 이야기해주세요.",
      avoid:"맥락 없이 '이거 해주세요'라고만 던지기. 실행 디테일부터 지적하기.",
      stress:"회의에서 점점 더 추상적인 이야기만 하고, 실행 논의를 계속 미루기 시작해요.",
      overload:"조용히 생각을 정리할 시간을 주고, 신뢰하는 사람과 1:1로 고민을 나눌 수 있게 해주세요. 큰 그림을 다시 그릴 수 있으면 회복돼요."
    },
    bestMatch:"driver",bestMatchShort:"실행 드라이버 🚀",bestReason:"설계자의 방향 제시 + 드라이버의 추진력 → '기획→실행'이 매끄럽게 이어져요.",
    tensionMatch:"builder",tensionMatchShort:"전략 과업가 ⚙️",tensionReason:"둘 다 전략적이지만, 사람 vs 과업 관점 차이로 우선순위 충돌 가능. 서로의 관점을 '보완'으로 인정하면 최강 조합."
  },
  builder:{name:"전략 과업가",emoji:"⚙️",code:"B",
    subtitle:"전략적 사고로 과업의 구조와 기준을 설계하는 BP",
    color:"#0984E3",colorLight:"#74B9FF",colorBg:"#EBF5FF",
    coreNeed:"'왜 하는지'와 '어떻게 해야 하는지'가 모두 명확해야 움직여요. 방향 없는 실행도, 기준 없는 전략도 불안해요.",
    desc:"'이거 왜 하는 거예요?'로 시작해서 '그럼 기준은 뭐예요?'로 끝나는 사람. 큰 그림을 보는 능력과 과업을 정교하게 다듬는 능력을 동시에 가지고 있어요.\n\n전략을 세울 때 사람의 감정보다는 논리와 구조가 먼저 떠오르고, 그래서 제도나 프로세스를 설계할 때 빛나는 타입이에요. '왜(Why)'와 '어떻게(How)'를 연결하는 다리를 놓는 사람.",
    painPoint:"근거 없이 방향이 바뀌는 것. '어제는 A라더니 오늘은 B?'가 반복되면 의욕이 뚝 떨어져요. 그리고 공들여 만든 체계를 아무도 안 쓸 때 — 그 허무함은 좀 큽니다.",
    flavor:{
      "C-D-":{name:"혁신 엔지니어",desc:"전략적 사고로 과업의 구조를 설계하는데, 새로운 방식을 데이터로 밀어요. 기존 제도의 문제를 수치로 파악하고, 더 나은 구조를 과감하게 도입해요. '이 프로세스가 왜 비효율적인지' 숫자로 보여주고 대안까지 설계하는 사람.",strength:"데이터 기반 제도 혁신 — 논리적 근거로 새로운 체계를 만들고 밀어붙여요",caution:"과감함이 앞서면 현장 저항에 부딪혀요. 변화 속도를 조절하세요"},
      "C-D+":{name:"창의적 설계자",desc:"전략적으로 과업 구조를 잡는데, 직관으로 트렌드를 포착하고 새로운 가능성을 열어요. 남들이 '그게 되겠어?'라고 할 때 구조적 가능성을 직감적으로 찾아내요. 틀을 만드는 능력에 창의성이 더해진 사람.",strength:"트렌드 포착 + 구조화 — 새로운 아이디어를 실현 가능한 체계로 바꿔요",caution:"직관적 판단이 틀릴 때를 대비해 핵심 가정은 검증하세요"},
      "C+D-":{name:"품질 관리자",desc:"전략적으로 과업을 설계하면서, 검증된 데이터로 기존 체계를 정교하게 다듬어요. 새로운 걸 도입하기보다 있는 걸 더 잘 돌아가게 만드는 데 집중해요. 수치로 효과를 증명하고, 꼼꼼하게 품질을 관리하는 사람.",strength:"데이터 기반 품질 관리 — 기존 시스템을 빈틈없이 다듬어요",caution:"개선에만 집중하다 큰 변화의 필요성을 놓칠 수 있어요"},
      "C+D+":{name:"실전 관리자",desc:"전략적 과업 설계 능력에 오래 쌓인 실무 경험이 더해진 사람이에요. 경험에서 나오는 감각으로 '이건 현장에서 안 돌아가'를 바로 알아채고, 현실적인 기준을 세워요. 흔들리지 않는 노하우로 체계를 운영하는 사람.",strength:"경험 기반 체계 운영 — 현실적이고 안정적인 기준을 만들어요",caution:"경험에만 의존하면 새로운 방법을 놓쳐요. 가끔은 '해본 적 없는 것'도 시도해보세요"}
    },
    keywords:["프로세스 설계","데이터 분석","제도 구축","표준화","논리적 판단"],
    energyUp:["평가·보상 체계 설계","HR 대시보드·데이터 분석","채용 프로세스 구조화·자동화","인사 제도 기획 및 개선","업무 매뉴얼·가이드 문서화"],
    energyDown:["감정적 갈등 중재·조율","빈번한 1:1 정서적 케어","구조 없이 즉흥적으로 바뀌는 요청","결론 없이 논의만 길어지는 회의"],
    manual:{
      request:"데이터와 논리로 설명하고, 충분한 검토 시간을 주세요. '이런 근거가 있어, 어떻게 생각해?'가 효과적이에요.",
      feedback:"구체적인 사실과 기준을 근거로 피드백해주세요. 감정보다 논리에 반응하는 타입이에요.",
      avoid:"급하게 '일단 해'라고 밀어붙이기. 근거 없이 방향을 바꾸기.",
      stress:"사소한 것까지 통제하려 하고, 소통을 줄이면서 혼자 일하기 시작해요.",
      overload:"복잡한 문제를 정리할 조용한 시간을 주고, 명확한 우선순위를 함께 정해주세요. '전부 다 완벽하지 않아도 돼'라는 메시지가 도움돼요."
    },
    bestMatch:"connector",bestMatchShort:"피플 커넥터 🤝",bestReason:"과업가의 체계 + 커넥터의 현장감 → '기준은 있는데 현장에서 안 돌아가는' 문제를 예방해요.",
    tensionMatch:"architect",tensionMatchShort:"조직 설계자 🏛️",tensionReason:"둘 다 전략적이지만 접근이 달라요. 설계자는 사람 중심, 과업가는 과업 중심. 초반에 방향 맞추면 강력한 조합."
  },
  connector:{name:"피플 커넥터",emoji:"🤝",code:"C",
    subtitle:"현장에서 사람의 마음을 읽고 직접 움직이는 BP",
    color:"#E17055",colorLight:"#FAB1A0",colorBg:"#FFF5F2",
    coreNeed:"'사람들이 괜찮아야' 내가 괜찮아요. 누군가가 힘들어하는 걸 알면서 모른 척하는 건 못 해요. 그리고 직접 가서 해결해야 직성이 풀려요.",
    desc:"팀에 문제가 생겼을 때 가장 먼저 '그 사람 요즘 괜찮아?'라고 묻고, 바로 찾아가는 사람. 회의실 분위기가 싸해지면 자연스럽게 말을 꺼내서 공기를 바꿔놓고, 본인은 그걸 의식하지도 못해요.\n\n점심시간에 혼자 밥 먹는 신입사원이 눈에 들어오고, 팀장님 표정이 어두운 게 신경 쓰이고, 슬랙 답장이 평소보다 짧으면 '무슨 일 있나?' 싶어지는 — 조직의 온도를 실시간으로 감지하면서 직접 현장에서 해결하는 사람이에요.",
    painPoint:"사람을 숫자로만 다루는 순간. '이번 달 퇴사율 3%니까 괜찮아'라는 말에 '그 3%가 누군데요?'라고 되묻고 싶어져요. 그리고 자기가 다 안고 있는데 아무도 몰라줄 때 — 웃으면서 속으로 지쳐요.",
    flavor:{
      "C-D-":{name:"분석적 케어러",desc:"현장에서 사람을 직접 만나고 챙기는데, 데이터를 들고 가요. 서베이 결과를 분석한 뒤 '이 수치 뒤에 어떤 사람이 있는지' 직접 찾아가서 확인해요. 새로운 케어 방법도 적극적으로 시도하면서, 그 효과를 숫자로 검증하는 사람.",strength:"데이터 + 현장감 — 숫자로 문제를 찾고 사람으로 해결해요",caution:"분석에 시간을 쓰다 사람에게 다가가는 타이밍을 놓칠 수 있어요"},
      "C-D+":{name:"체인지 서포터",desc:"사람을 직접 챙기면서도 변화를 두려워하지 않아요. 새로운 시도 속에서 사람들이 어떤 감정을 느끼는지 놓치지 않고, 변화가 사람에게 긍정적으로 작용하도록 중간 다리를 놓아요. 직관적으로 분위기를 읽고 바로 행동하는 사람.",strength:"변화 속 사람 케어 — 새 시도를 하면서도 사람의 불안을 잡아줘요",caution:"변화에 열정적인 나머지 현장의 피로감을 간과할 수 있어요"},
      "C+D-":{name:"조직 안전망",desc:"현장에서 사람을 직접 만나고 챙기면서, 이직률·만족도 같은 수치를 꼼꼼히 관리해요. 데이터로 위험 신호를 미리 잡고, 안정적으로 구성원을 돌보는 사람. 급격한 변화보다 '지금 있는 사람을 잘 지키는 것'에 집중해요.",strength:"데이터 기반 안정적 케어 — 수치로 위험을 감지하고 사람으로 해결해요",caution:"안정에 집중하다 필요한 변화의 시점을 놓칠 수 있어요"},
      "C+D+":{name:"따뜻한 해결사",desc:"오랜 경험에서 나오는 직관으로 사람의 상태를 정확히 읽고, 현장에서 직접 해결해요. 데이터 없이도 '이 사람 지금 힘들다'를 표정만 보고 알아채요. 안정적인 환경을 만들면서 사람을 돌보는 — 팀의 심리적 안전망.",strength:"경험 + 직관으로 사람 케어 — 말하기 전에 알아채고 다가가요",caution:"직감에만 의존하면 구조적 문제를 놓칠 수 있어요. 가끔은 데이터를 확인하세요"}
    },
    keywords:["관계 구축","갈등 중재","현장 소통","공감 능력","온보딩"],
    energyUp:["구성원 상담·고충 처리","현업 리더 파트너십 구축","신규 입사자 온보딩 설계·지원","팀빌딩·워크숍 기획 및 퍼실리테이션","조직 내 갈등 중재·소통 촉진"],
    energyDown:["장기 전략 문서 단독 작성","복잡한 데이터 분석·수치 리포트","사람과 단절된 채 하는 시스템 설계","혼자서 오래 해야 하는 기획 업무"],
    manual:{
      request:"따뜻하게 대화하고, '너만 할 수 있는 일'이라는 맥락을 전해주세요. 단, 거절이 어려우니 업무량을 같이 체크해주세요.",
      feedback:"관계를 해치지 않는 선에서, 개선점은 1:1로 조용히 전해주세요. 공개 비판은 크게 상처받아요.",
      avoid:"차갑고 사무적으로만 소통하기. 업무 결과만 이야기하고 과정의 노력을 무시하기.",
      stress:"모든 요청을 다 받아들이면서 자기 업무는 점점 미루기 시작해요. 밝은 척 하지만 표정이 지쳐보여요.",
      overload:"업무량을 함께 조정해주고, '네 일도 중요해'라는 메시지를 명확히 전해주세요. 편하게 이야기할 수 있는 시간이 회복에 도움돼요."
    },
    bestMatch:"builder",bestMatchShort:"전략 과업가 ⚙️",bestReason:"커넥터의 현장감 + 과업가의 체계 → '사람도 챙기고 과업도 잡는' 이상적인 HR이 가능해요.",
    tensionMatch:"driver",tensionMatchShort:"실행 드라이버 🚀",tensionReason:"커넥터는 관계를, 드라이버는 결과를 먼저 봐서 속도 차이 가능. '사람 이슈는 내가, 실행은 네가'로 분담하면 시너지."
  },
  driver:{name:"실행 드라이버",emoji:"🚀",code:"D",
    subtitle:"맡은 과업을 정확하고 빠르게 완수하는 BP",
    color:"#00B894",colorLight:"#55EFC4",colorBg:"#EFFFFA",
    coreNeed:"'진도가 나가야' 안심이 돼요. 할 일 목록에서 하나씩 지워나가는 그 감각이 없으면 하루가 허전해요.",
    desc:"월요일 아침에 이번 주 할 일 리스트를 이미 다 정리해놓고, 다른 사람이 '이번 주 뭐하지...'라고 하면 속으로 답답한 사람. '그래서 언제까지 하면 돼요?'가 입버릇이에요.\n\n채용 공고 3개를 동시에 돌리면서, 면접 일정 조율하고, 처우 협의 메일 보내고, 중간에 급한 인사 데이터 요청까지 처리해요. 과업 하나하나를 빠짐없이 완수하는 관리력 — 본인은 당연하다고 생각하지만, 팀에선 이 사람 없으면 진짜 안 돌아가요.",
    painPoint:"끝이 안 보이는 논의. '이건 좀 더 생각해보자'가 세 번째 반복되면 속에서 불이 나요. 그리고 열심히 실행했는데 '방향이 바뀌었어'라는 말 — 그게 제일 힘들어요.",
    flavor:{
      "C-D-":{name:"혁신 실행가",desc:"맡은 과업을 빠르고 정확하게 해내는데, 새로운 방법을 데이터로 찾아요. 기존 방식에 안 머물고, 효율을 높이는 툴이나 프로세스를 적극적으로 도입해요. 실행력에 혁신이 더해져서 '더 나은 방법으로 더 빠르게' 해내는 사람.",strength:"혁신적 실행 — 새로운 방법을 찾아 효율을 극대화해요",caution:"새 툴 도입에 빠져서 정작 실행이 늦어질 수 있어요. 실행이 우선이에요"},
      "C-D+":{name:"돌파형 실행가",desc:"감과 추진력으로 빠르게 결과를 내는 사람. 직관적으로 최적의 실행 경로를 찾고, 새로운 상황에서도 주저 없이 돌파해요. 계획보다 행동이 먼저인데, 그 감이 놀라울 정도로 잘 맞아요.",strength:"직관 + 추진력 — 감각적으로 최적의 방법을 찾아 바로 실행해요",caution:"감에만 의존하면 실수가 쌓여요. 중요한 건 한 번 더 확인하세요"},
      "C+D-":{name:"정밀 운영가",desc:"과업을 정확하고 빠르게 해내면서, 수치를 꼼꼼히 챙겨요. 안정적인 방식으로 실수 없이 완수하는 게 강점이에요. 정해진 기준과 데이터를 바탕으로 흔들림 없는 성과를 내는 사람.",strength:"데이터 기반 안정적 실행 — 실수 없이 꼼꼼하게 해내요",caution:"완벽함을 추구하다 속도가 떨어질 수 있어요. 때로는 '일단 돌려보기'도 필요해요"},
      "C+D+":{name:"베테랑 실행가",desc:"오랜 경험에서 나오는 감각으로 묵묵히 해내는 사람. 어떤 상황에서도 흔들리지 않고, 경험으로 쌓인 노하우로 최적의 실행 경로를 알아요. '이건 이렇게 하면 돼'가 몸에 밴 사람.",strength:"경험 기반 안정적 실행 — 어떤 상황에서도 흔들림 없이 해내요",caution:"익숙한 방식만 고집하면 더 효율적인 새 방법을 놓칠 수 있어요"}
    },
    keywords:["일정 관리","멀티태스킹","데드라인 준수","실행력","품질 관리"],
    energyUp:["채용 프로세스 운영 (서칭·면접·처우 협의)","HR 운영 실무 최적화·표준화","인사 데이터 정리·정기 리포트 작성","면접 일정 조율·후보자 커뮤니케이션","명확한 목표가 있는 단기 프로젝트"],
    energyDown:["끝이 안 보이는 방향성 논의","정답이 없는 감정적 대화 중재","장기적이고 추상적인 전략 기획","결론 없이 의견만 나누는 브레인스토밍"],
    manual:{
      request:"명확한 기대치와 데드라인을 먼저 제시해주세요. '이거를 언제까지 이 수준으로'가 효과적이에요.",
      feedback:"구체적으로 '이건 잘했고, 이건 이렇게 바꿔보자' 식으로 명확하게 전해주세요.",
      avoid:"모호하게 '알아서 잘 해봐'라고 던지기. 중간에 방향을 자주 바꾸기.",
      stress:"더 빠르게 밀어붙이면서 주변과 단절되기 시작해요. 과정을 건너뛰고 결과만 추구하며 짜증이 늘어나요.",
      overload:"작은 성취감을 느낄 수 있는 단기 과업을 주고, 명확한 우선순위를 함께 정해주세요. '이것만 끝내면 돼'라는 경계가 회복에 도움돼요."
    },
    bestMatch:"architect",bestMatchShort:"조직 설계자 🏛️",bestReason:"설계자의 비전 + 드라이버의 실행력 → '방향도 맞고 속도도 빠른' 가장 효과적인 조합.",
    tensionMatch:"connector",tensionMatchShort:"피플 커넥터 🤝",tensionReason:"드라이버는 빠른 실행을, 커넥터는 충분한 소통을 원해서 템포 차이 가능. 서로의 속도를 존중하면 균형 잡힌 팀."
  },
  /* ===== 5 NEW HYBRID TYPES ===== */
  strategist:{name:"전략 기획가",emoji:"🧭",code:"S",
    subtitle:"큰 그림을 보며 유연하게 풀어가는 BP",
    color:"#7C6DD8",colorLight:"#B8B0E8",colorBg:"#F5F3FF",
    coreNeed:"'왜 이걸 하는지'가 납득이 되어야 움직여요. 다만 방법은 사람이든 과업이든, 상황에 맞게 유연하게 택해요.",
    desc:"회의에서 '이거 왜 하는 거예요?'를 자주 묻지만, 고집스럽게 한 방식만 밀어붙이진 않아요. 전략이 잡히면 사람을 설득할 수도, 과업을 직접 정리할 수도 있는 — 도구를 가리지 않는 전략가예요.\n\n조직에 새로운 이슈가 생기면 일단 한 발 물러서서 전체 그림을 봐요. '이게 진짜 문제인가, 아니면 증상인가?' 하는 질문을 던지고, 방향이 잡히면 그때부터 빠르게 움직이는 사람이에요.",
    painPoint:"방향 없이 바쁘기만 한 상황. 매일 업무는 넘치는데 '이게 어디로 가는 거지?' 싶을 때 에너지가 빠져요. 전략적 사고를 할 여유조차 없을 때가 가장 답답해요.",
    flavor:{
      "C-D-":{name:"분석 전략가",desc:"왜 하는지를 먼저 따지는 전략가인데, 새로운 방향을 데이터로 뒷받침해요. 변화를 두려워하지 않으면서도 숫자 근거를 챙기니까, '이 방향이 맞다'는 걸 논리적으로 설득할 수 있어요. 사람이든 과업이든 상황에 맞게 유연하게 접근하면서, 근거는 철저히.",strength:"데이터 기반 유연한 전략 — 방향을 잡되 근거로 설득해요",caution:"분석에 빠져 '결정'을 계속 미루는 함정에 빠지지 마세요"},
      "C-D+":{name:"트렌드 기획가",desc:"큰 그림을 보는 전략가인데, 직관으로 미래를 읽어요. 남들보다 한 발 앞서 흐름을 포착하고, 조직이 나아갈 방향을 제시해요. 사람이든 과업이든 유연하게 접근하면서, 감각적으로 '이거다!' 싶은 방향을 잡는 사람.",strength:"트렌드 포착 + 전략 기획 — 남들보다 먼저 흐름을 읽어요",caution:"직관이 틀릴 때를 대비해야 해요. 핵심 가정은 데이터로 확인하세요"},
      "C+D-":{name:"전략 분석가",desc:"왜 하는지를 먼저 따지는 전략가인데, 리스크를 최소화하면서 확실한 근거로 방향을 잡아요. 안정적인 기반 위에서 데이터로 검증된 전략을 세우니까, 실패 가능성이 낮아요. 유연하게 접근하되 신중하게 결정하는 사람.",strength:"데이터 기반 안정 전략 — 리스크를 줄이면서 확실한 방향을 잡아요",caution:"신중함이 지나치면 기회를 놓쳐요. 때로는 불완전해도 빠르게 움직이세요"},
      "C+D+":{name:"시니어 기획가",desc:"큰 그림을 보면서 유연하게 접근하는 전략가인데, 경험에서 나오는 통찰로 전략을 짜요. 오래 쌓인 직관과 안목으로 '이건 이렇게 하면 될 거야'를 정확히 맞춰요. 안정적이면서도 상황에 맞게 판단하는 사람.",strength:"경험 + 직관 기반 전략 — 균형 잡힌 판단으로 방향을 잡아요",caution:"과거 경험에 갇히면 새로운 상황에 대응이 늦어져요"}
    },
    keywords:["전략적 사고","방향 설정","유연한 접근","본질 파악","큰 그림"],
    energyUp:["조직 이슈의 근본 원인 분석","HR 전략 방향 수립","경영진 보고·커뮤니케이션","변화 관리 기획","복잡한 이해관계 정리"],
    energyDown:["단순 반복 행정 업무","방향 없이 주어지는 급한 요청","디테일한 숫자 검증 작업","정해진 매뉴얼대로만 하는 일"],
    manual:{
      request:"배경(Why)을 먼저 설명해주세요. 방향이 잡혀야 움직이는 타입이에요.",
      feedback:"전체 방향에 대한 피드백을 먼저 주고, 세부사항은 그 다음에.",
      avoid:"맥락 없이 '급해, 일단 해'라고만 던지기.",
      stress:"계속 원론적인 질문만 하고, 실행으로 넘어가지 못해요. 회의가 길어지기 시작하면 신호예요.",
      overload:"전략적 사고를 정리할 조용한 시간을 주세요. '일단 큰 방향만 잡자'고 범위를 좁혀주면 회복돼요."
    },
    bestMatch:"executor",bestMatchShort:"현장 실행가 ⚡",bestReason:"전략가의 방향 설정 + 실행가의 추진력 → 생각이 행동으로 이어져요.",
    tensionMatch:"taskmaster",tensionMatchShort:"과업 관리자 📊",tensionReason:"전략가는 Why를, 과업 관리자는 What을 먼저 봐서 초점이 다를 수 있어요. 서로의 관점을 나누면 보완이 돼요."
  },
  facilitator:{name:"관계 촉진자",emoji:"💬",code:"F",
    subtitle:"사람 사이를 연결하고 분위기를 만드는 BP",
    color:"#D35D6E",colorLight:"#E8A0AB",colorBg:"#FFF4F6",
    coreNeed:"'사람들이 편하게 이야기할 수 있는 분위기'가 중요해요. 관계가 좋아야 일도 된다고 믿어요.",
    desc:"팀 회의에서 말이 없는 사람이 있으면 '○○님은 어떻게 생각해요?'라고 자연스럽게 물어보는 사람. 갈등이 생기면 양쪽 이야기를 다 들어보고 중간에서 다리를 놓아요.\n\n전략이든 실행이든 중요하지만, 이 사람에겐 '그 과정에서 사람들이 어떤 기분인지'가 더 먼저예요. 사람들이 방어적이지 않게, 솔직하게 이야기할 수 있는 공간을 만드는 — 눈에 안 보이지만 팀에서 가장 중요한 역할을 해요.",
    painPoint:"차갑고 사무적인 분위기. 사람을 숫자로만 다루거나, 관계를 무시하고 결과만 밀어붙이는 환경에서 서서히 지쳐요. '이 사람들 감정은 누가 챙겨?'가 계속 머릿속에 맴돌아요.",
    flavor:{
      "C-D-":{name:"분석적 촉진자",desc:"사람 사이를 연결하고 분위기를 만드는데, 데이터로 관계 이슈를 진단해요. 서베이 분석도 하고 직접 만나기도 하면서, 새로운 소통 방식을 시도해요. '이 팀 몰입도가 떨어졌는데, 왜 그런지 직접 들어볼게요'가 자연스러운 사람.",strength:"데이터 + 관계 — 숫자로 문제를 찾고 사람으로 풀어요",caution:"분석과 소통 사이에서 에너지가 분산될 수 있어요. 우선순위를 정하세요"},
      "C-D+":{name:"혁신적 촉진자",desc:"사람 사이를 잇는 촉진자인데, 색다른 방법으로 팀 분위기를 바꿔요. 새로운 워크숍 포맷, 창의적 소통 채널 등 '이렇게 해보면 어떨까?'를 실험해요. 직관적으로 분위기를 읽고, 새로운 접근으로 관계를 만드는 사람.",strength:"창의적 관계 구축 — 색다른 방법으로 팀 분위기를 바꿔요",caution:"새 시도에 너무 몰두하면 기본적인 1:1 케어를 놓칠 수 있어요"},
      "C+D-":{name:"체계적 촉진자",desc:"사람을 연결하고 분위기를 만드는데, 정기 면담·만족도 조사 같은 구조화된 방식으로 해요. 안정적인 환경에서 데이터를 활용해 관계를 관리하니까, 빠짐없이 사람을 챙길 수 있어요. 체계적으로 사람을 돌보는 사람.",strength:"구조화된 관계 관리 — 빠짐없이 체계적으로 사람을 챙겨요",caution:"체계에 의존하면 '표정으로만 보이는' 미묘한 감정을 놓칠 수 있어요"},
      "C+D+":{name:"마음 촉진자",desc:"경험에서 나오는 따뜻함으로 사람을 잇는 사람. 직관과 오래된 경험으로 '이 사람 지금 뭔가 있다'를 말하기 전에 알아채요. 안정적인 분위기를 만들면서 사람들이 솔직하게 이야기할 수 있는 공간을 열어주는 사람.",strength:"경험 + 직관 기반 관계 — 말하기 전에 알아채고 다가가요",caution:"직관에만 의존하면 놓치는 사람이 생겨요. 가끔은 체계적 체크도 필요해요"}
    },
    keywords:["관계 구축","분위기 조성","경청","중재","소통 촉진"],
    energyUp:["구성원 1:1 면담·상담","팀빌딩·워크숍 퍼실리테이션","갈등 중재·소통 촉진","신규 입사자 온보딩 지원","현업 리더와의 파트너십 구축"],
    energyDown:["혼자 오래 해야 하는 분석 업무","사람 없이 시스템만 만드는 작업","감정이 배제된 의사결정 과정","장기 전략 문서 단독 작성"],
    manual:{
      request:"따뜻하게 대화하고, 이 일이 사람들에게 어떤 의미인지 함께 이야기해주세요.",
      feedback:"1:1로 조용히, 관계를 해치지 않는 선에서 전해주세요.",
      avoid:"차갑고 사무적으로만 소통하기. 과정의 노력을 무시하기.",
      stress:"평소보다 말이 줄고, 혼자 있으려는 시간이 늘어요. 다른 사람 걱정은 하면서 본인 이야기는 안 해요.",
      overload:"'네 컨디션이 중요해'라는 메시지를 명확히 전해주세요. 편하게 이야기할 수 있는 1:1 시간이 회복에 도움돼요."
    },
    bestMatch:"taskmaster",bestMatchShort:"과업 관리자 📊",bestReason:"촉진자의 사람 케어 + 관리자의 과업 집중 → 사람도 챙기고 일도 되는 균형.",
    tensionMatch:"executor",tensionMatchShort:"현장 실행가 ⚡",tensionReason:"촉진자는 충분히 이야기하고 싶고, 실행가는 빨리 움직이고 싶어서 템포가 다를 수 있어요."
  },
  allrounder:{name:"올라운더",emoji:"🎯",code:"X",
    subtitle:"상황에 따라 유연하게 역할을 전환하는 BP",
    color:"#8B5CF6",colorLight:"#C4B5FD",colorBg:"#F5F3FF",
    coreNeed:"'균형'이 자연스러워요. 한쪽으로 너무 치우치면 불편하고, 여러 관점을 고려해서 판단하는 게 편해요.",
    desc:"'너는 어떤 타입이야?'라고 물으면 '상황에 따라 다른데...'라고 답하는 사람. 이게 우유부단한 게 아니라, 진짜로 여러 관점을 동시에 볼 수 있는 거예요.\n\n전략 회의에서는 큰 그림을 보다가, 실행 단계에서는 디테일을 챙기고, 사람 이슈가 생기면 먼저 다가가요. 한 가지에 극단적으로 몰입하지 않는 대신, 팀에서 빠진 역할을 자연스럽게 채워넣는 능력이 있어요.",
    painPoint:"한 가지만 극단적으로 밀어붙여야 하는 상황. '전략만 해' 또는 '실행만 해'라고 역할이 좁혀지면 답답해요. 그리고 '넌 뭘 제일 잘하는 거야?'라는 질문에 딱 하나로 대답하기 어려운 게 가끔 고민이에요.",
    flavor:{
      "C-D-":{name:"분석적 멀티플레이어",desc:"여러 역할을 유연하게 오가는 올라운더인데, 새로운 도전을 좋아하면서도 데이터로 근거를 챙겨요. 전략도, 실행도, 사람도 상황에 맞게 전환하면서 변화를 주도하고 숫자로 뒷받침하는 사람.",strength:"유연한 역할 전환 + 데이터 기반 변화 — 어디서든 근거 있게 움직여요",caution:"이것저것 다 하면서 어느 하나에도 깊이 파지 못할 수 있어요"},
      "C-D+":{name:"모험적 올라운더",desc:"여러 역할을 넘나드는 올라운더인데, 직관으로 새로운 시도를 주도해요. 감각적으로 '지금 여기서 내가 뭘 해야 하는지'를 파악하고, 변화를 두려워하지 않으면서 균형을 잡아요. 팀에서 가장 먼저 새로운 걸 시도하는 사람.",strength:"직관 + 모험 — 팀에서 새로운 시도를 주도하면서 균형도 잡아요",caution:"새 시도에 빠지면 기존 역할이 흔들려요. 기본 과업을 먼저 챙기세요"},
      "C+D-":{name:"신뢰의 올라운더",desc:"여러 역할을 유연하게 오가면서, 검증된 방법과 수치로 팀의 중심을 잡아요. 안정적으로 균형을 유지하면서 데이터를 바탕으로 판단하니까, 팀에서 가장 신뢰할 수 있는 존재. '이 사람이 하면 안심'인 사람.",strength:"안정적 균형 + 데이터 — 팀의 든든한 중심축이에요",caution:"안정에 치우치면 유연성이 줄어요. 때로는 과감한 전환도 필요해요"},
      "C+D+":{name:"안정적 허브",desc:"여러 역할을 넘나들면서, 경험과 직관으로 팀을 지탱하는 사람. 오래 쌓인 경험에서 나오는 균형 감각으로 어떤 상황이든 대응해요. '일단 이 사람한테 물어보면 길이 보인다'는 팀의 허브.",strength:"경험 기반 균형 — 어떤 상황에서든 안정적으로 팀을 지탱해요",caution:"허브 역할에 익숙해지면 자기만의 전문 영역을 키우기 어려워요"}
    },
    keywords:["유연성","균형 감각","다재다능","상황 적응","역할 전환"],
    energyUp:["여러 팀·부서를 넘나드는 크로스펑셔널 프로젝트","전략부터 실행까지 전체 과정을 아우르는 업무","다양한 이해관계자와 소통·조율","팀에 부족한 역할을 채우는 일","새로운 영역을 빠르게 학습·적용"],
    energyDown:["한 가지만 반복하는 단조로운 업무","극단적으로 좁은 역할 범위","한 관점만 고집하는 환경","변화 없이 정해진 루틴만 돌리는 일"],
    manual:{
      request:"전체 맥락과 기대 역할을 함께 알려주세요. 어디서 어떤 역할을 하면 되는지가 명확하면 잘 움직여요.",
      feedback:"구체적으로 '이 부분은 잘했고, 이건 더 집중해보자' 식으로 방향을 잡아주세요.",
      avoid:"역할을 너무 좁게 한정짓기. '넌 이것만 해'라고 가두기.",
      stress:"이것저것 다 하면서 정작 하나도 깊이 못 파고 있다는 느낌이 들기 시작해요. 산만해 보이면 신호예요.",
      overload:"우선순위를 함께 정리해주세요. '지금 가장 중요한 한 가지'를 정해주면 초점이 돌아와요."
    },
    bestMatch:"architect",bestMatchShort:"조직 설계자 🏛️",bestReason:"설계자의 명확한 방향 + 올라운더의 유연한 실행 → 전략이 현실에 안착해요.",
    tensionMatch:"builder",tensionMatchShort:"전략 과업가 ⚙️",tensionReason:"과업가의 체계적 접근이 올라운더에겐 경직되게 느껴질 수 있어요. 서로의 스타일을 존중하면 보완이 돼요."
  },
  taskmaster:{name:"과업 관리자",emoji:"📊",code:"M",
    subtitle:"과업의 기준과 품질을 책임지는 BP",
    color:"#2D8CCA",colorLight:"#7FB8DE",colorBg:"#EDF6FF",
    coreNeed:"'기준이 명확해야' 일이 돼요. 과업 하나하나에 측정 가능한 기준이 있어야 하고, 그걸 맞추는 게 중요해요.",
    desc:"'이거 기준이 뭐예요?'가 자연스럽게 나오는 사람. 느낌으로 결정하는 걸 불편해하고, 명확한 기준을 세우고 그에 맞춰 과업을 관리하고 싶어해요.\n\n전략적으로 멀리 보는 것보다는 지금 눈앞의 과업을 정확하게 처리하는 데 집중하고, 그렇다고 속도만 내는 게 아니라 기준과 품질을 같이 챙기는 사람이에요. 보고서 제출 전 한 번 더 숫자를 확인하는 타입.",
    painPoint:"기준 없이 감으로 결정하는 환경. '그냥 느낌이 그래서'가 근거가 되는 회의를 참기 어렵고, 본인이 꼼꼼하게 정리한 기준을 무시당할 때 많이 상해요.",
    flavor:{
      "C-D-":{name:"개선형 관리자",desc:"과업의 기준과 품질을 책임지는데, 기존 방식에 안 머물고 데이터로 더 나은 기준을 만들어요. '이 프로세스의 효율이 왜 낮은지' 분석하고 개선안을 내는 사람. 변화를 추구하면서도 과업 품질은 절대 놓치지 않아요.",strength:"데이터 기반 과업 혁신 — 더 나은 기준을 만들고 개선해요",caution:"기준을 자주 바꾸면 현장이 혼란스러워요. 안정화 기간도 필요해요"},
      "C-D+":{name:"민첩한 관리자",desc:"과업 기준과 품질을 챙기면서, 직감으로 우선순위를 빠르게 잡아요. 변화에 민첩하게 대응하면서도 과업 품질을 놓치지 않는 사람. '지금 가장 중요한 게 뭔지'를 감각적으로 알아채고 바로 방향을 잡아요.",strength:"민첩한 우선순위 판단 — 빠르게 대응하면서 품질도 잡아요",caution:"직감에 의존한 판단이 틀릴 때가 있어요. 중요한 건 데이터로 확인하세요"},
      "C+D-":{name:"정밀 관리자",desc:"과업의 기준과 품질을 책임지면서, 안정적이고 꼼꼼하게 수치로 증명되는 결과물을 만들어요. 데이터로 기준을 세우고, 그 기준에 정확히 맞추는 데 집중해요. '숫자가 말해주는 것만 믿어요'가 이 사람의 철학.",strength:"데이터 기반 정밀 관리 — 흔들림 없이 꼼꼼하게 품질을 잡아요",caution:"완벽주의가 심해지면 속도가 느려져요. 때론 '충분히 좋으면 OK'도 필요해요"},
      "C+D+":{name:"숙련 관리자",desc:"오랜 실무 경험에서 나오는 감각으로 과업의 흐름을 관리해요. 기준과 품질을 챙기면서도, 경험으로 쌓인 노하우가 있으니 효율적으로 돌릴 수 있어요. '이건 이 정도면 충분해'를 정확히 아는 사람.",strength:"경험 기반 효율적 관리 — 과하지도 부족하지도 않은 기준을 잡아요",caution:"경험에만 기대면 새로운 기준이 필요한 상황을 놓칠 수 있어요"}
    },
    keywords:["데이터 기반","기준 설정","품질 관리","과업 집중","객관적 판단"],
    energyUp:["HR 데이터 분석·대시보드 구축","평가 기준 설정·모니터링","인사 제도 운영·관리","채용 프로세스 품질 관리","정기 리포트 작성·분석"],
    energyDown:["정답 없는 감정적 대화","구조 없이 흘러가는 브레인스토밍","측정 불가능한 추상적 목표","사람 간 갈등 중재"],
    manual:{
      request:"명확한 기대치와 기준을 먼저 제시해주세요. 데이터나 사례가 있으면 더 효과적이에요.",
      feedback:"구체적인 사실과 기준을 근거로 피드백해주세요. 감정보다 논리에 반응하는 타입이에요.",
      avoid:"기준 없이 '알아서 해'라고 던지기. 감으로 결론을 내리기.",
      stress:"점점 더 꼼꼼해지면서 속도가 느려져요. 완벽하게 정리될 때까지 공유를 미루기 시작해요.",
      overload:"'80%면 충분해'라는 메시지가 도움돼요. 명확한 우선순위를 함께 정해주세요."
    },
    bestMatch:"facilitator",bestMatchShort:"관계 촉진자 💬",bestReason:"관리자의 객관적 기준 + 촉진자의 사람 감각 → 공정하면서도 따뜻한 HR이 가능해요.",
    tensionMatch:"strategist",tensionMatchShort:"전략 기획가 🧭",tensionReason:"관리자는 지금의 기준을, 기획가는 미래의 방향을 먼저 봐서 초점이 다를 수 있어요."
  },
  executor:{name:"현장 실행가",emoji:"⚡",code:"E",
    subtitle:"현장에서 직접 부딪히며 결과를 만드는 BP",
    color:"#10B981",colorLight:"#6EE7B7",colorBg:"#ECFDF5",
    coreNeed:"'일이 진전되는 게 보여야' 에너지가 나요. 논의보다 행동이 편하고, 직접 해봐야 감이 와요.",
    desc:"'일단 해보자'가 입에 붙은 사람. 완벽한 계획보다 빠른 실행을 선호하고, 현장에서 직접 부딪히면서 방법을 찾아가는 타입이에요.\n\n사람 관계도 신경 쓰고, 과업 퀄리티도 챙기지만, 둘 다 '직접 하면서' 해결하는 스타일. 회의실에서 논의하는 것보다 현장에서 뛰어다니는 게 더 잘 맞아요.",
    painPoint:"끝없는 회의와 논의. '이거 좀 더 생각해보자'가 반복되면 답답해지고, 결론 없이 흩어지는 미팅 후에 에너지가 바닥나요.",
    flavor:{
      "C-D-":{name:"분석적 행동가",desc:"현장에서 직접 부딪히며 결과를 만드는데, 데이터를 들고 뛰어요. 새로운 방법을 실험하면서도 수치로 효과를 확인하고, 사람 관계도 과업도 직접 하면서 해결해요. '일단 해보고, 숫자로 검증하자'가 이 사람의 방식.",strength:"현장 실행 + 데이터 검증 — 뛰면서도 숫자를 챙겨요",caution:"분석과 실행을 동시에 하다 에너지가 빨리 소진돼요. 선택과 집중이 필요해요"},
      "C-D+":{name:"개척자",desc:"현장에서 직접 부딪히면서 결과를 만드는데, 직감으로 돌파해요. 새로운 시도를 두려워하지 않고, 감각적으로 최적의 실행 방법을 찾아요. '안 해본 건 해봐야 알지'가 이 사람의 철학. 팀에서 가장 먼저 현장에 뛰어드는 사람.",strength:"직관 + 개척 정신 — 새로운 현장에서도 주저 없이 돌파해요",caution:"무모함과 용기의 경계를 의식하세요. 리스크 체크 한 번은 필요해요"},
      "C+D-":{name:"운영 전문가",desc:"현장에서 직접 해결하는 실행가인데, 검증된 방법으로 안정적이고 꼼꼼하게 관리해요. 데이터를 바탕으로 현장을 운영하니까 실수가 적고, 일관된 품질을 유지해요. '정해진 방식대로 정확하게'가 강점인 사람.",strength:"안정적 현장 운영 — 검증된 방법으로 꼼꼼하게 관리해요",caution:"안정적 운영에 익숙해지면 급한 상황에서 유연한 대응이 어려울 수 있어요"},
      "C+D+":{name:"숙련 실행가",desc:"경험에서 나오는 감각으로 현장을 이끄는 사람. 몸에 밴 노하우로 어떤 상황에서도 해결책을 찾아요. 사람도 과업도 직접 하면서 해결하는데, 안정적인 경험이 뒷받침되니까 흔들림이 없어요.",strength:"경험 기반 현장 대응 — 어떤 상황에서도 해결책을 찾아요",caution:"'내가 다 해야 해'에 빠지면 위임이 안 돼요. 후배에게 경험을 나눠주세요"}
    },
    keywords:["실행력","현장 중심","빠른 대응","직접 부딪힘","행동 지향"],
    energyUp:["현장 이슈 즉시 대응·해결","신규 프로젝트 빠른 착수","채용·온보딩 실무 운영","현업 리더와 직접 협업","단기 목표 달성 프로젝트"],
    energyDown:["장기 전략 문서 작성","끝이 안 보이는 방향성 논의","결론 없는 반복 회의","혼자서 하는 데이터 분석"],
    manual:{
      request:"결론과 기대치를 먼저 말해주세요. '이거를 이렇게'가 명확하면 바로 움직여요.",
      feedback:"명확하고 구체적으로. '이건 잘했고, 이건 바꿔보자' 식이 제일 좋아요.",
      avoid:"결론 없이 논의만 길게 이어가기. 실행 전에 완벽한 준비를 요구하기.",
      stress:"더 빠르게 밀어붙이면서 주변 반응을 못 보기 시작해요. '일단 해'가 너무 잦아지면 신호예요.",
      overload:"작은 성취를 느낄 수 있는 단기 과업을 주세요. 빠르게 끝낼 수 있는 일이 에너지를 회복시켜요."
    },
    bestMatch:"strategist",bestMatchShort:"전략 기획가 🧭",bestReason:"기획가의 방향 + 실행가의 추진력 → 생각과 행동이 균형을 이뤄요.",
    tensionMatch:"facilitator",tensionMatchShort:"관계 촉진자 💬",tensionReason:"실행가는 빠르게 움직이고 싶고, 촉진자는 충분히 소통하고 싶어서 속도 차이가 날 수 있어요."
  }
};
const TYPES=["architect","strategist","builder","facilitator","allrounder","taskmaster","connector","executor","driver"];
const TYPE_THRESHOLD=5;
const typeFromScores=(se,pt)=>{
  const sz=se<=-TYPE_THRESHOLD?'S':se>=TYPE_THRESHOLD?'E':'M';
  const pz=pt<=-TYPE_THRESHOLD?'P':pt>=TYPE_THRESHOLD?'T':'M';
  return{SP:'architect',SM:'strategist',ST:'builder',MP:'facilitator',MM:'allrounder',MT:'taskmaster',EP:'connector',EM:'executor',ET:'driver'}[sz+pz];
};
const getBaseType=tk=>({strategist:'architect',facilitator:'connector',taskmaster:'builder',executor:'driver',allrounder:'architect'}[tk]||tk);

/* Flavor system: CS × DI → 4 flavors */
const FLAVOR_LABELS={
  "C-D-":{name:"혁신 분석가",icon:"🔬",desc:"변화를 추구하면서 데이터로 검증하는 타입"},
  "C-D+":{name:"창의적 탐험가",icon:"🚀",desc:"변화를 추구하면서 직관으로 방향을 잡는 타입"},
  "C+D-":{name:"안정적 전략가",icon:"🛡️",desc:"안정을 추구하면서 데이터로 판단하는 타입"},
  "C+D+":{name:"경험 기반 수호자",icon:"🌿",desc:"안정을 추구하면서 직관과 경험으로 판단하는 타입"}
};
const getFlavorKey=(cs,di)=>(cs<=0?"C-":"C+")+(di<=0?"D-":"D+");

/* Phase-based Task System */
const TASK_PHASES = [
  {id:"direction",name:"방향 설정",icon:"🧭",desc:"왜 하는지, 어디로 가는지 결정",
    bestTypes:["architect","strategist","allrounder"],
    goodTypes:["builder","facilitator"],
    styleFit:{cs:"change",di:null,note:"변화를 추구하는 성향이 새 방향 제시에 유리해요"}},
  {id:"design",name:"체계 설계",icon:"📐",desc:"프로세스, 기준, 구조 만들기",
    bestTypes:["builder","taskmaster","architect"],
    goodTypes:["strategist","allrounder"],
    styleFit:{cs:"stable",di:"data",note:"안정+데이터 성향이 꼼꼼한 설계에 강해요"}},
  {id:"communication",name:"이해관계자 소통",icon:"💬",desc:"설득, 공감대 형성, 갈등 조율",
    bestTypes:["connector","facilitator","architect"],
    goodTypes:["allrounder","executor"],
    styleFit:{cs:null,di:"intuition",note:"직관 성향이 공감·스토리 기반 설득에 강해요"}},
  {id:"execution",name:"실행 운영",icon:"⚡",desc:"계획을 실제로 돌리고, 마감 지키기",
    bestTypes:["driver","executor","taskmaster"],
    goodTypes:["connector","allrounder"],
    styleFit:{cs:"stable",di:null,note:"안정 성향이 일관된 운영과 마감 관리에 강해요"}},
  {id:"analysis",name:"데이터 분석",icon:"📊",desc:"결과 측정, 효과 검증, 개선점 도출",
    bestTypes:["builder","taskmaster","driver"],
    goodTypes:["architect","strategist"],
    styleFit:{cs:null,di:"data",note:"데이터 성향이 수치 기반 분석에 강해요"}}
];

const HR_PROJECTS = [
  {name:"채용 브랜딩 기획",phases:["direction","communication","design","execution","analysis"]},
  {name:"평가·보상 체계 개편",phases:["direction","design","communication","execution","analysis"]},
  {name:"조직문화 진단·개선",phases:["direction","analysis","design","communication","execution"]},
  {name:"온보딩 프로그램 구축",phases:["direction","design","execution","communication","analysis"]},
  {name:"HR 데이터 대시보드 구축",phases:["direction","design","analysis","execution","communication"]},
  {name:"리더십 개발 프로그램",phases:["direction","communication","design","execution","analysis"]},
];


/* 1:1 Relationship Guide Data */
const REL_GUIDE = {
  "architect>architect":{req:"서로 큰 그림 논의를 즐기지만, 누가 실행할지 꼭 정하세요",fb:"방향성 공감 후 '그래서 구체적으로는?' 질문을 서로 던져주세요",warn:"둘 다 전략만 논의하다 실행이 빠질 수 있어요",synergy:"조직 비전과 변화 관리를 함께 설계하면 깊이 있는 결과물이 나와요"},
  "architect>builder":{req:"'왜'를 먼저 공유하고, 구조화할 시간을 충분히 주세요",fb:"논리와 데이터로 설명하면 잘 받아들여요",warn:"설계자는 유연하게, 빌더는 체계적으로 — 속도 차이에 주의",synergy:"설계자가 방향을 잡고 빌더가 시스템화하면 지속 가능한 결과물이 나와요"},
  "architect>connector":{req:"의미와 맥락을 공유하면 커넥터가 현장에서 전파해줄 거예요",fb:"따뜻하게, 1:1로. 공개적 피드백은 피해주세요",warn:"설계자의 추상적 방향이 커넥터에게 막연하게 느껴질 수 있어요",synergy:"설계자가 변화의 방향을, 커넥터가 구성원의 수용을 담당하면 완벽해요"},
  "architect>driver":{req:"배경(Why)을 먼저 설명한 뒤, 명확한 기대치와 데드라인을 주세요",fb:"구체적으로 '이건 잘했고, 이건 바꿔보자' 식으로",warn:"드라이버에게 모호한 방향만 던지면 답답해해요",synergy:"설계자의 비전 + 드라이버의 실행력 = 가장 효과적인 조합이에요"},
  "builder>architect":{req:"데이터·논리만 전달하지 말고, '이게 왜 중요한지' 맥락도 같이 주세요",fb:"방향성 먼저 인정하고, 디테일 피드백은 그 다음에",warn:"빌더의 체계 중심 접근이 설계자에겐 '유연하지 않다'로 느껴질 수 있어요",synergy:"빌더의 구조 + 설계자의 방향감이 만나면 전략과 실행이 연결돼요"},
  "builder>builder":{req:"서로 기준과 프레임을 먼저 맞추고, 역할을 명확히 나누세요",fb:"객관적 데이터로 서로 검증해주면 신뢰가 쌓여요",warn:"둘 다 완벽주의라 의견 충돌 시 평행선을 달릴 수 있어요",synergy:"복잡한 제도 설계를 함께 하면 빈틈 없는 시스템이 나와요"},
  "builder>connector":{req:"따뜻한 톤으로, 이 일이 사람들에게 어떤 의미인지 함께 설명해주세요",fb:"1:1로 조용히, 관계를 해치지 않는 선에서",warn:"빌더의 직접적·논리적 소통이 커넥터에겐 차갑게 느껴질 수 있어요",synergy:"빌더가 만든 시스템을 커넥터가 현장에 부드럽게 안착시켜요"},
  "builder>driver":{req:"명확한 기대치·데드라인·기준을 제시하면 바로 실행해요",fb:"구체적 사실 기반으로 명확하게",warn:"빌더가 검토에 시간을 쓰는 동안 드라이버가 답답해할 수 있어요",synergy:"빌더가 설계하고 드라이버가 실행하면 효율 극대화"},
  "connector>architect":{req:"설계자의 큰 그림을 존중하되, '현장에서는 이런 반응이 있어요'로 보완해주세요",fb:"방향성 먼저 공감하고, 현장 피드백을 추가하는 순서로",warn:"커넥터의 '사람 반응' 중심 피드백이 설계자에겐 실행 저항으로 느껴질 수 있어요",synergy:"커넥터의 현장 인사이트가 설계자의 전략에 현실감을 더해요"},
  "connector>builder":{req:"감정이 아닌 구체적 사례와 데이터로 전달하면 잘 받아들여요",fb:"논리적 근거를 곁들여 피드백하면 설득력이 올라가요",warn:"커넥터의 감정 중심 소통이 빌더에겐 비효율적으로 느껴질 수 있어요",synergy:"커넥터가 현장 목소리를 모아오면 빌더가 시스템에 반영해요"},
  "connector>connector":{req:"서로 공감을 잘 하지만, 구체적 액션과 마감을 꼭 정하세요",fb:"따뜻하게 주고받되, '그래서 어떻게 할까?'로 마무리해주세요",warn:"둘 다 거절을 못 해서 서로 업무를 떠넘기는 구조가 될 수 있어요",synergy:"구성원 케어와 소통 촉진에서 최강 팀워크를 발휘해요"},
  "connector>driver":{req:"결론과 기대치를 먼저 전달하고, 맥락은 간결하게 추가해주세요",fb:"명확하고 구체적으로. 감정적 표현보다 사실 위주로",warn:"커넥터가 관계를 챙기느라 느려지면 드라이버가 답답해할 수 있어요",synergy:"커넥터가 사람 이슈를, 드라이버가 실행을 맡으면 서로 부담이 줄어요"},
  "driver>architect":{req:"실행 계획뿐 아니라 '왜 이 방향인지' 배경도 같이 공유해주세요",fb:"방향성을 먼저 인정한 후 실행 관점 피드백을",warn:"드라이버의 '빨리 결론 내자'가 설계자에겐 '깊이 없다'로 느껴질 수 있어요",synergy:"드라이버의 실행력이 설계자의 전략을 현실로 만들어요"},
  "driver>builder":{req:"데이터와 논리 근거를 준비해서 전달하면 검토가 빨라져요",fb:"사실 기반으로, 충분한 검토 시간을 주세요",warn:"드라이버의 '일단 해보자'가 빌더에겐 '준비 안 됐는데'로 느껴질 수 있어요",synergy:"드라이버가 빠르게 실행하고 빌더가 체계를 보완하면 속도+품질 둘 다 잡아요"},
  "driver>connector":{req:"따뜻한 톤을 추가하고, 업무량이 과하지 않은지 체크해주세요",fb:"1:1로 조용히, 노력을 인정한 뒤 개선점을",warn:"드라이버의 빠른 속도와 직접적 소통이 커넥터에겐 압박으로 느껴질 수 있어요",synergy:"드라이버가 실행을, 커넥터가 사람 케어를 나누면 균형 잡힌 팀"},
  "driver>driver":{req:"서로 기대치와 역할을 명확히 나누고, 겹치지 않게 하세요",fb:"결과 기반으로 직접적으로. 둘 다 명확한 걸 좋아해요",warn:"둘 다 빠르게 밀어붙여서 관계나 큰 그림이 빠질 수 있어요",synergy:"실행력이 두 배! 단기 프로젝트에서 최강의 효율을 보여요"}
};

/* Phase-based person task matching */
function getPersonPhases(member){
  const tk=member.typeKey;
  const best=TASK_PHASES.filter(p=>p.bestTypes.includes(tk));
  const good=TASK_PHASES.filter(p=>!p.bestTypes.includes(tk)&&p.goodTypes.includes(tk));
  return{bestPhases:best,goodPhases:good};
}

/* ===== TEAM ANALYSIS HELPERS ===== */
function analyzeTeamComposition(members){
  const tips=[];
  const total=members.length;
  const nl=(arr)=>arr.map(m=>m.name+'님').join(', ');
  // ── 이름 표기 ──
  const hasFL=members.some(m=>m.cs!==undefined&&m.cs!==null);
  const mIcon=(m)=>{
    if(!hasFL||m.cs===undefined||m.cs===null)return T[m.typeKey].emoji;
    const fk=getFlavorKey(m.cs,m.di||0);
    const fl=FLAVOR_LABELS[fk];
    return fl?fl.icon:T[m.typeKey].emoji;
  };
  // 짧은 표기: 이름님 (팁 본문용)
  const mn=(m)=>m.name+'님';
  const mns=(arr)=>arr.map(m=>m.name+'님').join(', ');
  // 소개용 풀 표기: 이름님(아이콘 프로필명) — TIP1에서만 사용
  const mfl=(m)=>{
    if(!hasFL||m.cs===undefined||m.cs===null)return`${m.name}님(${T[m.typeKey].name})`;
    const fk=getFlavorKey(m.cs,m.di||0);
    const fo=T[m.typeKey].flavor?T[m.typeKey].flavor[fk]:null;
    const fname=fo&&typeof fo==='object'?fo.name:null;
    const fl=FLAVOR_LABELS[fk];
    return fname?`${m.name}님(${fl?fl.icon:''}${fname})`:`${m.name}님(${T[m.typeKey].name})`;
  };
  const mfls=(arr)=>arr.map(m=>mfl(m)).join(' · ');
  // ── CS/DI 접근 방식 한 줄 ──
  const styleNote=(m)=>{
    if(!hasFL||m.cs===undefined)return'';
    const c=(m.cs||0)<0?'변화를 추구하며':'안정을 지키며';
    const d=(m.di||0)<0?'데이터로 판단':'직관으로 판단';
    return`${c} ${d}하는 스타일`;
  };

  // ── 영역 분류 ──
  const getZone=(m)=>{
    const sLabel=m.se<=-3?'전략':m.se>=3?'실행':'';
    const pLabel=m.pt<=-3?'관계':m.pt>=3?'과업':'';
    if(sLabel&&pLabel)return sLabel+'+'+pLabel;
    if(sLabel)return sLabel;
    if(pLabel)return pLabel;
    return '균형';
  };
  const zoneMap={};
  members.forEach(m=>{const z=getZone(m);if(!zoneMap[z])zoneMap[z]=[];zoneMap[z].push(m);});

  // ── 축별 분류 ──
  const stratM=members.filter(m=>m.se<=-3);
  const execM=members.filter(m=>m.se>=3);
  const pplM=members.filter(m=>m.pt<=-3);
  const taskM=members.filter(m=>m.pt>=3);
  const balM=members.filter(m=>Math.abs(m.se)<3&&Math.abs(m.pt)<3);

  // ── 팀 무게중심 ──
  const avgSE=members.reduce((s,m)=>s+m.se,0)/total;
  const avgPT=members.reduce((s,m)=>s+m.pt,0)/total;

  // ── TIP 1: 팀 구성 오버뷰 — 플레이버명으로 소개 ──
  const memberIntros=members.map(m=>mfl(m)).join(' · ');
  const zoneCount=Object.keys(zoneMap).length;
  const seSpread=Math.max(...members.map(m=>m.se))-Math.min(...members.map(m=>m.se));
  const ptSpread=Math.max(...members.map(m=>m.pt))-Math.min(...members.map(m=>m.pt));
  let shape;
  if(zoneCount>=4) shape='다양한 관점이 넓게 퍼진 팀';
  else if(zoneCount===1) shape='한 영역에 밀집된 팀';
  else if(seSpread>=14||ptSpread>=14) shape='양 극단에 퍼진 팀';
  else if(balM.length>=total*0.5) shape='중앙부에 모인 유연한 팀';
  else shape=`${zoneCount}개 영역에 분포된 팀`;
  tips.push({icon:"🧭",text:`${total}명 ${shape}: ${memberIntros}`});

  // ── TIP 2: SE축 다이나믹 ──
  if(stratM.length>0||execM.length>0){
    if(stratM.length>0&&execM.length>0){
      const sNote=stratM[0].cs!==undefined?` (${styleNote(stratM[0])})`:'';
      const eNote=execM[0].cs!==undefined?` (${styleNote(execM[0])})`:'';
      if(stratM.length>execM.length){
        tips.push({icon:"🎯",text:`${mns(stratM)}이 방향을 잡고, ${mns(execM)}이 실행해요. 전략 쪽이 많아서 방향 논의가 길어지기 쉬우니, 회의 마지막 5분은 ${execM[0].name}님에게 실행 정리를 맡기세요.${balM.length>0?` ${mns(balM)}이 실행을 보조하면 보완돼요.`:''}`});
      }else if(execM.length>stratM.length){
        tips.push({icon:"⚡",text:`${mns(execM)}이 실행하고, ${mns(stratM)}이 방향을 잡아요. 실행이 많아 '일단 하자'로 흐르기 쉬우니, ${stratM[0].name}님이 회의 초반 방향을 짚어주세요.${balM.length>0?` ${mns(balM)}이 방향 점검을 보조할 수 있어요.`:''}`});
      }else{
        tips.push({icon:"🔗",text:`${mns(stratM)}이 방향을 잡고 ${mns(execM)}이 실행으로 옮기는 릴레이가 가능해요.${sNote&&eNote?` ${stratM[0].name}님은${sNote}, ${execM[0].name}님은${eNote}이라 접근은 다르지만 보완이 돼요.`:''}`});
      }
    }else if(stratM.length>0){
      tips.push({icon:"🎯",text:`${mns(stratM)}이 전략 쪽에 모여있고 실행형이 없어요. 방향은 잘 잡지만 실행이 느려질 수 있어요.${balM.length>0?` ${mns(balM)}이 실행을 의식적으로 챙겨주세요.`:' 회의마다 실행 체크리스트를 반드시 만드세요.'}`});
    }else{
      tips.push({icon:"⚡",text:`${mns(execM)}이 실행 쪽에 모여있고 전략형이 없어요. 속도는 빠르지만 '왜 하는지' 검증이 빠지기 쉬워요.${balM.length>0?` ${mns(balM)}이 방향 체크를 맡으면 좋아요.`:' 월 1회 방향 점검 시간을 잡으세요.'}`});
    }
  }

  // ── TIP 3: PT축 다이나믹 ──
  if(pplM.length>0||taskM.length>0){
    if(pplM.length>0&&taskM.length>0){
      if(pplM.length<taskM.length){
        tips.push({icon:"💬",text:`관계형이 ${pplM.length}명(${mns(pplM)})뿐이에요. 과업형(${mns(taskM)})이 많아서 효율은 좋지만 팀원 감정이 수면 아래로 가라앉기 쉬워요.${pplM.length===1?` ${pplM[0].name}님이 혼자 감당하지 않도록 다른 팀원들도 의식적으로 관심을 나눠주세요.`:''}`});
      }else if(pplM.length>taskM.length){
        tips.push({icon:"📊",text:`${mns(pplM)}이 관계 중심이고 과업형은 ${mns(taskM)}뿐이에요. 구성원 케어는 잘 되지만, ${taskM[0].name}님에게 의사결정의 데이터 근거를 맡기면 균형이 잡혀요.`});
      }else{
        tips.push({icon:"🤝",text:`관계형(${mns(pplM)})과 과업형(${mns(taskM)})이 균형 잡혀 있어요. 의견이 갈릴 때 '오늘의 결정 기준'을 먼저 합의해두면 효과적이에요.`});
      }
    }else if(pplM.length>0){
      tips.push({icon:"💬",text:`${mns(pplM)}이 관계 중심이지만 과업형이 없어요. 분위기는 좋지만 객관적 기준이 약해질 수 있어요. 주요 의사결정에 숫자 근거를 붙이세요.`});
    }else{
      tips.push({icon:"📊",text:`${mns(taskM)}이 과업 중심이지만 관계형이 없어요. 효율은 높지만 팀원 감정이 안 보일 수 있어요.${balM.length>0?` ${mns(balM)}이 분위기 체크를 의식적으로 해주면 보완돼요.`:' 월 1회 체크인을 넣으세요.'}`});
    }
  }

  // ── TIP 4: 의사결정 스타일 차이 (데이터 vs 직관이 섞여있을 때만) ──
  if(hasFL){
    const dataM=members.filter(m=>(m.di||0)<0);
    const intuM=members.filter(m=>(m.di||0)>0);
    if(dataM.length>0&&intuM.length>0&&tips.length<5){
      tips.push({icon:"⚖️",text:`의사결정 방식이 갈려요 — ${mns(dataM)}은 숫자 근거를 먼저 보고, ${mns(intuM)}은 현장 감각을 먼저 봐요. 제안할 때 '데이터 + 현장 사례' 세트로 준비하면 모두 납득해요.`});
    }
  }

  // ── TIP 5: 아웃라이어 or 클러스터 패턴 ──
  if(total>=3&&tips.length<5){
    let maxDist=0,outlier=null;
    members.forEach(m=>{
      const alone=members.filter(m2=>m2.typeKey===m.typeKey).length===1;
      if(!alone)return;
      const d=Math.abs(m.se-avgSE)+Math.abs(m.pt-avgPT);
      if(d>maxDist){maxDist=d;outlier=m;}
    });
    if(outlier&&maxDist>6){
      tips.push({icon:"🔍",text:`${outlier.name}님은 팀 평균에서 가장 먼 위치예요. 이 관점이 무시되면 팀의 맹점이 돼요. 의사결정 전 '${outlier.name}님, 다른 시각 없어?' 한마디가 큰 차이를 만들어요.`});
    }else{
      const dupes=Object.entries(zoneMap).filter(([z,ms])=>ms.length>=2).sort((a,b)=>b[1].length-a[1].length);
      if(dupes.length>0){
        const [zone,ms]=dupes[0];
        tips.push({icon:"👥",text:`${mns(ms)}이 같은 ${zone} 영역에 모여 있어요. 서로 편하지만 같은 맹점을 공유할 수 있어요. ${nl(members.filter(m=>!ms.includes(m)))}의 의견을 의식적으로 물어보세요.`});
      }
    }
  }

  // ── Fallback ──
  if(tips.length<=1){
    if(balM.length===total)tips.push({icon:"🤝",text:"모두 비슷한 중앙 영역에 있어요. 소통은 편하지만 강한 전문성이 필요한 국면에서 약할 수 있어요. 각자 한 가지 전문 역할을 정해두면 좋아요."});
    else tips.push({icon:"✨",text:"의견이 다를 때 '오늘의 결정 기준'을 미리 합의해두면 갈등을 예방할 수 있어요."});
  }
  return tips.slice(0,5);
}

function generateConflictDetail(a,b){
  const tA=T[a.typeKey],tB=T[b.typeKey];
  const seDiff=a.se-b.se,ptDiff=a.pt-b.pt;
  const seGap=Math.abs(seDiff),ptGap=Math.abs(ptDiff);
  const s=seDiff<=0?{m:a,t:tA}:{m:b,t:tB};
  const e=seDiff<=0?{m:b,t:tB}:{m:a,t:tA};
  const p=ptDiff<=0?{m:a,t:tA}:{m:b,t:tB};
  const k=ptDiff<=0?{m:b,t:tB}:{m:a,t:tA};
  const n=(m)=>m.name+'님';
  let reason,tip;
  if(seGap>=8&&ptGap>=8){
    reason=`${n(s.m)}(${s.t.name})은 '왜 하는지'와 '사람 반응'을 먼저 보는데, ${n(e.m)}(${e.t.name})은 '빨리 끝내기'와 '결과물'을 먼저 봐요. ${n(s.m)} 입장에선 '왜 그렇게 급해?', ${n(e.m)} 입장에선 '왜 자꾸 논의만 해?'가 되기 쉬워요.`;
    tip=`${n(s.m)}이 방향을 잡으면 ${n(e.m)}이 바로 실행 계획으로 옮기는 '릴레이' 구조를 만드세요. 방향이 80%만 잡혀도 실행을 시작해도 된다고 합의하면 돼요.`;
  }else if(seGap>ptGap){
    reason=`${n(s.m)}(${s.t.name})은 '이걸 왜 하는지' 방향부터 잡고 싶은데, ${n(e.m)}(${e.t.name})은 '일단 시작하자'가 먼저예요. ${n(s.m)} 입장에선 '방향도 없이 뛰어?', ${n(e.m)} 입장에선 '또 회의만 하고 끝나는 거 아냐?'가 될 수 있어요.`;
    tip=`회의 초반 15분은 ${n(s.m)}의 방향 논의, 후반은 ${n(e.m)}의 실행 정리로 나누세요. ${n(s.m)}에게 '방향 잡아줘서 고마워', ${n(e.m)}에게 '실행 정리 덕분에 움직일 수 있어'라고 인정해주면 시너지가 나요.`;
  }else{
    reason=`${n(p.m)}(${p.t.name})은 '사람들이 어떻게 느낄지'가 먼저 신경 쓰이는데, ${n(k.m)}(${k.t.name})은 '기준에 맞는지, 결과가 나오는지'를 먼저 봐요. ${n(p.m)} 입장에선 '사람 마음은 안 보여?', ${n(k.m)} 입장에선 '감정에 끌려다니면 일이 안 돼'가 될 수 있어요.`;
    tip=`${n(p.m)}이 구성원 반응을 체크하고 ${n(k.m)}이 기준과 품질을 챙기는 역할을 나누세요. ${n(p.m)}의 피드백은 '반대'가 아니라 '실행 경로 보완'이라는 걸 ${n(k.m)}이 이해하면 최고의 조합이 돼요.`;
  }
  // CS/DI 업무 스타일 차이 추가 코멘트
  const hasStyle=a.cs!==undefined&&b.cs!==undefined;
  if(hasStyle){
    const csGap=Math.abs((a.cs||0)-(b.cs||0));
    const diGap=Math.abs((a.di||0)-(b.di||0));
    const cA=(a.cs||0)<0?a:b, cB=(a.cs||0)<0?b:a;
    const dA=(a.di||0)<0?a:b, dB=(a.di||0)<0?b:a;
    if(csGap>=4&&diGap>=4){
      reason+=` 게다가 업무 스타일도 달라요 — ${n(cA)}은 변화+${(cA===dA)?'데이터':'직관'}형이고 ${n(cB)}은 안정+${(cB===dA)?'데이터':'직관'}형이라, 접근 방식 자체가 다를 수 있어요.`;
      tip+=` 업무 스타일 차이도 인식하세요: 새로운 시도를 할 때 ${n(cA)}의 추진력과 ${n(cB)}의 안정성을 조합하세요.`;
    }else if(csGap>=4){
      reason+=` 업무 스타일도 차이가 있어요 — ${n(cA)}은 변화를 추구하고 ${n(cB)}은 안정을 추구해서, 새로운 시도에 대한 온도 차이가 있을 수 있어요.`;
      tip+=` 변화가 필요한 안건은 ${n(cA)}이, 안정적 운영이 필요한 안건은 ${n(cB)}이 리드하면 자연스러워요.`;
    }else if(diGap>=4){
      reason+=` 의사결정 방식도 달라요 — ${n(dA)}은 데이터를 먼저 보고, ${n(dB)}은 직관과 현장 경험을 먼저 봐요.`;
      tip+=` 제안할 때 ${n(dA)}에겐 숫자 근거를, ${n(dB)}에겐 현장 사례를 함께 준비하면 둘 다 납득해요.`;
    }
  }
  return{reason,tip};
}

function findConflictPairs(members){
  const pairs=[];
  for(let i=0;i<members.length;i++){
    for(let j=i+1;j<members.length;j++){
      const a=members[i],b=members[j];
      const tA=T[a.typeKey],tB=T[b.typeKey];
      const aTensionB=tA.tensionMatch===b.typeKey;
      const bTensionA=tB.tensionMatch===a.typeKey;
      const isTension=aTensionB||bTensionA;
      const dist=Math.abs(a.se-b.se)+Math.abs(a.pt-b.pt);
      if(isTension||dist>=16){
        const detail=generateConflictDetail(a,b);
        pairs.push({a,b,dist,...detail,isTension});
      }
    }
  }
  pairs.sort((x,y)=>(y.isTension?1:0)-(x.isTension?1:0)||y.dist-x.dist);
  return pairs.slice(0,3);
}

function getPersonTasks(member){
  return getPersonPhases(member);
}

/* ===== SUPABASE ===== */
const SB_URL = 'https://vzygascbawpkzbbmaoef.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ6eWdhc2NiYXdwa3piYm1hb2VmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2OTc5NDUsImV4cCI6MjA4NjI3Mzk0NX0.Vu3qCnxA9aP8GoMKS1huHGYRTYrMIytjmUzHhZ1NPiA';
const sb = (typeof supabase!=='undefined' && SB_URL.indexOf('YOUR_PROJECT')===-1)
  ? supabase.createClient(SB_URL,SB_KEY) : null;

function generateTeamId(){
  const a='0123456789abcdefghijklmnopqrstuvwxyz';
  const b=crypto.getRandomValues(new Uint8Array(8));
  return Array.from(b,x=>a[x%a.length]).join('');
}

async function sbCreateTeam(name){
  const id=generateTeamId();
  const{data,error}=await sb.from('teams').insert({id,name}).select().single();
  if(error){
    if(error.code==='23505'){return sbCreateTeam(name);}// PK collision retry
    throw new Error(error.message);
  }
  return data;
}
async function sbGetTeam(teamId){
  const{data,error}=await sb.from('teams').select('*').eq('id',teamId).single();
  if(error)throw new Error(error.message);
  return data;
}
async function sbSaveResult(teamId,name,se,pt,typeKey,strengthAnswers){
  // strength_answers: convert to array format for Supabase text[] column compatibility
  const saArr=Array.isArray(strengthAnswers)?strengthAnswers:['CS:'+(strengthAnswers.CS||0),'DI:'+(strengthAnswers.DI||0)];
  const{data,error}=await sb.from('results').upsert({
    team_id:teamId,name,se_score:se,pt_score:pt,type_key:typeKey,strength_answers:saArr
  },{onConflict:'team_id,name'}).select().single();
  if(error)throw new Error(error.message);
  return data;
}
async function sbLoadResults(teamId){
  const{data,error}=await sb.from('results').select('*').eq('team_id',teamId).order('created_at',{ascending:true});
  if(error)throw new Error(error.message);
  return data;
}

/* ===== STATE ===== */
const EMPTY_SS={CS:0,DI:0};
let state = {screen:"intro", qIdx:0, scores:{SE:0,PT:0}, strengthScores:{...EMPTY_SS}, sqIdx:0, userName:"", members:[], selectedMember:0,
  mode:"solo", teamId:null, teamName:"", loading:false, error:null, _teamLoaded:false, sharedResult:false, _viewMemberIdx:-1};
let skipScroll = false;

/* ===== PERSISTENCE ===== */
function saveMyResult(){
  try{localStorage.setItem('hrbp_result',JSON.stringify({userName:state.userName,scores:state.scores,strengthScores:state.strengthScores}));}catch(e){}
}
function saveTeam(){
  try{localStorage.setItem('hrbp_team',JSON.stringify(state.members));}catch(e){}
}
function loadMyResult(){
  try{const d=JSON.parse(localStorage.getItem('hrbp_result'));if(d&&d.userName){state.userName=d.userName;state.scores=d.scores;
    // Backward compat: old format had strategy/system/people/execution; new has CS/DI
    const ss=d.strengthScores||{};
    state.strengthScores=ss.CS!==undefined?{CS:ss.CS,DI:ss.DI||0}:{...EMPTY_SS};
    return true;}}catch(e){}return false;
}
function loadTeam(){
  try{const d=JSON.parse(localStorage.getItem('hrbp_team'));if(d&&d.length>0){state.members=d;return true;}}catch(e){}return false;
}
function getTeamLink(){
  const codes=state.members.map(m=>`${m.name}:${T[m.typeKey].code}:${m.se}:${m.pt}`);
  return location.origin+location.pathname+'#team='+encodeURIComponent(codes.join('|'));
}
function parseTeamHash(){
  const h=location.hash;if(!h.startsWith('#team='))return false;
  const codeMap={A:"architect",S:"strategist",B:"builder",F:"facilitator",X:"allrounder",M:"taskmaster",C:"connector",E:"executor",D:"driver"};
  const members=[];
  decodeURIComponent(h.slice(6)).split('|').forEach(line=>{
    const p=line.trim().split(':');
    if(p.length>=4){const name=p[0].trim(),tc=p[1].trim().toUpperCase(),se=parseInt(p[2]),pt=parseInt(p[3]);
      if(name&&codeMap[tc]&&!isNaN(se)&&!isNaN(pt))members.push({name,se:Math.max(-16,Math.min(16,se)),pt:Math.max(-16,Math.min(16,pt)),typeKey:codeMap[tc]});}
  });
  if(members.length>0){state.members=members;return true;}return false;
}
function getResultShareLink(){
  const ss=state.strengthScores;
  const parts=[state.userName,state.scores.SE,state.scores.PT,ss.CS||0,ss.DI||0];
  return location.origin+location.pathname+'?r='+encodeURIComponent(parts.join('.'));
}
function parseResultParam(){
  const r=new URLSearchParams(location.search).get('r');
  if(!r)return false;
  const p=decodeURIComponent(r).split('.');
  if(p.length<3)return false;
  const name=p[0],se=parseInt(p[1]),pt=parseInt(p[2]);
  if(!name||isNaN(se)||isNaN(pt))return false;
  state.userName=name;
  state.scores={SE:Math.max(-16,Math.min(16,se)),PT:Math.max(-16,Math.min(16,pt))};
  // New format: CS,DI (2 values) or old format: strategy,system,people,execution (4 values)
  if(p.length>=5)state.strengthScores={CS:parseInt(p[3])||0,DI:parseInt(p[4])||0};
  else if(p.length>=7)state.strengthScores={CS:0,DI:0}; // Old format fallback
  state.sharedResult=true;
  return true;
}

/* ===== RENDER ===== */
const $=id=>document.getElementById(id);
const app=()=>$("app");

function render(){
  if(!skipScroll) window.scrollTo(0,0);
  skipScroll=false;
  switch(state.screen){
    case "intro": renderIntro(); break;
    case "createTeam": renderCreateTeam(); break;
    case "inviteLink": renderInviteLink(); break;
    case "teamJoin": renderTeamJoin(); break;
    case "questions": renderQuestion(); break;
    case "strength": renderStrength(); break;
    case "name": renderName(); break;
    case "result": renderResult(); break;
    case "team": renderTeam(); break;
  }
}

function renderIntro(){
  const saved=(()=>{try{const s=JSON.parse(localStorage.getItem('hrbp_result'));return s&&s.userName?s:null;}catch(e){return null;}})();
  app().innerHTML=`
  <div class="fade-in" style="text-align:center;padding-top:40px">
    <div style="font-size:56px;margin-bottom:16px">🧭</div>
    <h1 style="font-size:28px;font-weight:800;line-height:1.3;letter-spacing:-.5px;margin-bottom:8px">나는 어떤 HRBP일까?</h1>
    <p style="font-size:15px;color:#6B7280;margin-bottom:28px;line-height:1.6">HRBP 업무 스타일 진단 · ${QUESTIONS.length+STRENGTH_QUESTIONS.length}문항 · 약 5분</p>
    <div class="card" style="text-align:left">
      <p style="font-size:15px;color:#374151;line-height:1.8;margin-bottom:18px">22개 질문에 답하면, 나의 HRBP 업무 스타일을 알려드려요.</p>
      ${[["⚡","에너지가 나는 과업 / 깎이는 과업"],["🎨","같은 유형도 다른 — 나만의 플레이버"],["📋","과업 단계별 적합도 (기획→실행→분석)"],["😰","스트레스 시그널 & 회복 방법"],["🤝","팀원별 1:1 소통 가이드"],["📊","팀 과업 단계별 배치 추천"]].map(([i,t])=>`<div style="display:flex;align-items:center;gap:12px;padding:10px 14px;background:#F9FAFB;border-radius:12px;font-size:14px;color:#374151;margin-bottom:8px"><span style="font-size:18px">${i}</span>${t}</div>`).join("")}
      <p style="font-size:13px;color:#9CA3AF;margin-top:14px;text-align:center">정답은 없어요 — 직관적으로 골라주세요</p>
    </div>
    <button class="btn btn-primary" onclick="startTest()" style="margin-top:16px">테스트 시작하기</button>
    ${saved?`<button class="btn btn-secondary" onclick="goSavedResult()" style="margin-top:10px">📊 이전 결과 보기 (${saved.userName})</button>`:''}
    ${saved?`<button onclick="resetAllData()" style="margin-top:24px;background:none;border:none;font-size:12px;color:#D1D5DB;cursor:pointer;font-family:inherit;padding:8px">🗑️ 데이터 초기화</button>`:''}
  </div>`;
}

function renderCreateTeam(){
  app().innerHTML=`
  <div class="fade-in" style="padding-top:60px;text-align:center">
    <div style="font-size:48px;margin-bottom:16px">👥</div>
    <h2 style="font-size:22px;font-weight:700;margin-bottom:8px">우리 팀 만들기</h2>
    <p style="font-size:14px;color:#6B7280;margin-bottom:32px;line-height:1.6">
      팀 이름을 입력하면 초대 링크가 생성돼요.<br>
      팀원들이 링크를 통해 테스트하면 결과가 자동으로 모여요.
    </p>
    <input id="teamNameInput" class="input" placeholder="팀 이름 (예: 모비데이즈 HRBP팀)" style="text-align:center;font-size:16px;margin-bottom:16px" onkeydown="if(event.key==='Enter')handleCreateTeam()">
    ${state.error?`<p style="font-size:13px;color:#DC2626;margin-bottom:12px">${state.error.message}</p>`:''}
    <button class="btn btn-primary" onclick="handleCreateTeam()" id="createTeamBtn" ${state.loading?'disabled style="opacity:0.6"':''}>
      ${state.loading?'<span class="spinner" style="width:18px;height:18px;border-width:2px;vertical-align:middle;margin-right:8px"></span>팀 생성 중...':'팀 만들기'}
    </button>
    <button class="btn btn-secondary" onclick="state.screen='result';state.error=null;render()" style="margin-top:10px">← 돌아가기</button>
  </div>`;
  if(!state.loading){setTimeout(()=>{const inp=$("teamNameInput");if(inp)inp.focus();},300);}
}

function renderInviteLink(){
  const link=location.origin+location.pathname+'?team='+state.teamId;
  app().innerHTML=`
  <div class="fade-in" style="padding-top:40px;text-align:center">
    <div style="font-size:48px;margin-bottom:16px">🎉</div>
    <h2 style="font-size:22px;font-weight:700;margin-bottom:6px">"${state.teamName}" 팀이 만들어졌어요!</h2>
    <p style="font-size:14px;color:#6B7280;margin-bottom:8px;line-height:1.6">
      내 결과는 자동 저장됐어요.<br>
      아래 링크를 팀원들에게 공유하세요!
    </p>
    <div class="card" style="background:#F3F0FF;border:1px solid #C4B5FD">
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:10px">초대 링크</p>
      <div style="background:#fff;border:1px solid #E5E7EB;border-radius:10px;padding:12px;font-size:13px;color:#374151;word-break:break-all;margin-bottom:12px;font-family:monospace">${link}</div>
      <button class="btn btn-primary" onclick="copyInviteLink()" id="inviteCopyBtn" style="font-size:14px;padding:12px">📋 초대 링크 복사</button>
    </div>
    <button class="btn btn-primary" onclick="goTeamView()" style="margin-top:16px">팀 결과 보기</button>
    <button class="btn btn-secondary" onclick="goResult()" style="margin-top:10px">← 내 결과로 돌아가기</button>
  </div>`;
}

function renderTeamJoin(){
  if(state.loading){
    app().innerHTML=`
    <div class="fade-in" style="padding-top:100px;text-align:center">
      <div style="margin-bottom:16px"><span class="spinner"></span></div>
      <p style="font-size:16px;color:#6B7280">팀 정보를 불러오는 중...</p>
    </div>`;
    return;
  }
  if(state.error){
    app().innerHTML=`
    <div class="fade-in" style="padding-top:100px;text-align:center">
      <div style="font-size:48px;margin-bottom:16px">😢</div>
      <h2 style="font-size:20px;font-weight:700;margin-bottom:8px">팀을 찾을 수 없어요</h2>
      <p style="font-size:14px;color:#6B7280;margin-bottom:24px">${state.error.message}</p>
      <button class="btn btn-primary" onclick="location.href=location.pathname">처음으로 돌아가기</button>
    </div>`;
    return;
  }
  app().innerHTML=`
  <div class="fade-in" style="padding-top:60px;text-align:center">
    <div style="font-size:48px;margin-bottom:16px">👋</div>
    <h2 style="font-size:22px;font-weight:700;margin-bottom:6px">"${state.teamName}" 팀에 합류하기</h2>
    <p style="font-size:14px;color:#6B7280;margin-bottom:32px;line-height:1.6">
      이름을 입력하고 테스트를 시작하세요.<br>
      결과는 자동으로 팀에 저장돼요.
    </p>
    <input id="joinNameInput" class="input" placeholder="이름 (예: 김모비)" style="text-align:center;font-size:16px;margin-bottom:16px" onkeydown="if(event.key==='Enter')startTeamTestAsJoiner()">
    <button class="btn btn-primary" onclick="startTeamTestAsJoiner()">테스트 시작하기</button>
    <button class="btn btn-secondary" onclick="goTeamViewDirect()" style="margin-top:10px">팀 결과 바로 보기</button>
  </div>`;
  setTimeout(()=>{const inp=$("joinNameInput");if(inp)inp.focus();},300);
}

function renderQuestion(){
  const q=QUESTIONS[state.qIdx];
  const totalAll=QUESTIONS.length+STRENGTH_QUESTIONS.length;
  const pct=((state.qIdx+1)/totalAll)*100;
  const colors=["#6C5CE7","#A29BFE","#74B9FF","#0984E3"];
  const labels=["확실히 A","약간 A","약간 B","확실히 B"];
  const sizes=[46,36,36,46];

  app().innerHTML=`
  <div style="margin-top:20px">
    <div style="display:flex;justify-content:space-between;margin-bottom:8px">
      <span style="font-size:13px;color:#9CA3AF;font-weight:600">Q${state.qIdx+1} / ${totalAll}</span>
      <span style="font-size:13px;color:#9CA3AF">${Math.round(pct)}%</span>
    </div>
    <div style="height:6px;background:#E5E7EB;border-radius:3px;overflow:hidden">
      <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#6C5CE7,#0984E3);border-radius:3px;transition:width .5s"></div>
    </div>
  </div>
  <div class="fade-in" style="padding:40px 0 20px;text-align:center">
    <h2 style="font-size:18px;font-weight:700;line-height:1.5;margin-bottom:28px">${q.text}</h2>
    <div style="display:flex;gap:10px;margin-bottom:12px">
      <div style="flex:1;padding:14px;background:#F9FAFB;border-radius:14px;font-size:13px;color:#374151;line-height:1.5;text-align:center">
        <span style="font-size:11px;color:#6C5CE7;font-weight:700;display:block;margin-bottom:4px">A</span>${q.a}
      </div>
      <div style="flex:1;padding:14px;background:#F9FAFB;border-radius:14px;font-size:13px;color:#374151;line-height:1.5;text-align:center">
        <span style="font-size:11px;color:#0984E3;font-weight:700;display:block;margin-bottom:4px">B</span>${q.b}
      </div>
    </div>
    <div class="scale-row">
      ${[-2,-1,1,2].map((v,i)=>`
        <div class="scale-col">
          <button class="scale-btn" style="width:${sizes[i]}px;height:${sizes[i]}px" onclick="answerQ(${v},${i})" onmouseover="this.style.borderColor='${colors[i]}'" onmouseout="this.style.borderColor='#E5E7EB'"></button>
          <span class="scale-label">${labels[i]}</span>
        </div>
      `).join("")}
    </div>
    <div style="display:flex;justify-content:space-between;padding:0 8px;margin-top:4px">
      <span style="font-size:12px;color:#6C5CE7;font-weight:600">← A</span>
      <span style="font-size:12px;color:#0984E3;font-weight:600">B →</span>
    </div>
  </div>`;
}

function renderStrength(){
  const sq=STRENGTH_QUESTIONS[state.sqIdx];
  const totalAll=QUESTIONS.length+STRENGTH_QUESTIONS.length;
  const qNum=QUESTIONS.length+state.sqIdx+1;
  const pct=(qNum/totalAll)*100;
  const colors=["#6C5CE7","#A29BFE","#74B9FF","#0984E3"];
  const labels=["확실히 A","약간 A","약간 B","확실히 B"];
  const sizes=[46,36,36,46];

  app().innerHTML=`
  <div style="margin-top:20px">
    <div style="display:flex;justify-content:space-between;margin-bottom:8px">
      <span style="font-size:13px;color:#9CA3AF;font-weight:600">Q${qNum} / ${totalAll}</span>
      <span style="font-size:13px;color:#9CA3AF">${Math.round(pct)}%</span>
    </div>
    <div style="height:6px;background:#E5E7EB;border-radius:3px;overflow:hidden">
      <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#6C5CE7,#0984E3);border-radius:3px;transition:width .5s"></div>
    </div>
  </div>
  <div class="fade-in" style="padding:40px 0 20px;text-align:center">
    <h2 style="font-size:18px;font-weight:700;line-height:1.5;margin-bottom:28px">${sq.text}</h2>
    <div style="display:flex;gap:10px;margin-bottom:12px">
      <div style="flex:1;padding:14px;background:#F9FAFB;border-radius:14px;font-size:13px;color:#374151;line-height:1.5;text-align:center">
        <span style="font-size:11px;color:#6C5CE7;font-weight:700;display:block;margin-bottom:4px">A</span>${sq.a}
      </div>
      <div style="flex:1;padding:14px;background:#F9FAFB;border-radius:14px;font-size:13px;color:#374151;line-height:1.5;text-align:center">
        <span style="font-size:11px;color:#0984E3;font-weight:700;display:block;margin-bottom:4px">B</span>${sq.b}
      </div>
    </div>
    <div class="scale-row">
      ${[-2,-1,1,2].map((v,i)=>`
        <div class="scale-col">
          <button class="scale-btn" style="width:${sizes[i]}px;height:${sizes[i]}px" onclick="answerSQ(${v},${i})" onmouseover="this.style.borderColor='${colors[i]}'" onmouseout="this.style.borderColor='#E5E7EB'"></button>
          <span class="scale-label">${labels[i]}</span>
        </div>
      `).join("")}
    </div>
    <div style="display:flex;justify-content:space-between;padding:0 8px;margin-top:4px">
      <span style="font-size:12px;color:#6C5CE7;font-weight:600">← A</span>
      <span style="font-size:12px;color:#0984E3;font-weight:600">B →</span>
    </div>
  </div>`;
}

function renderName(){
  // If name already set (team joiner), skip to submit
  if(state.mode==="team"&&state.userName){submitName();return;}
  app().innerHTML=`
  <div class="fade-in" style="padding-top:60px;text-align:center">
    <div style="font-size:48px;margin-bottom:16px">✨</div>
    <h2 style="font-size:22px;font-weight:700;margin-bottom:8px">거의 다 됐어요!</h2>
    <p style="font-size:14px;color:#6B7280;margin-bottom:32px">${state.mode==="team"?'팀에 저장할 이름을 입력해주세요':'팀 조합 분석에 사용할 이름을 입력해주세요'}</p>
    <input id="nameInput" class="input" placeholder="이름 (예: 김모비)" value="${state.userName||''}" style="text-align:center;font-size:16px;margin-bottom:16px" onkeydown="if(event.key==='Enter')submitName()">
    <button class="btn btn-primary" onclick="submitName()">결과 보기</button>
  </div>`;
  setTimeout(()=>{const inp=$("nameInput");if(inp)inp.focus();},300);
}

function renderResult(){
  const tk=typeFromScores(state.scores.SE,state.scores.PT);
  const t=T[tk];

  // Flavor analysis (CS/DI axes)
  const fk=getFlavorKey(state.strengthScores.CS||0,state.strengthScores.DI||0);
  const fl=FLAVOR_LABELS[fk];
  const flavorObj=t.flavor?t.flavor[fk]:null;
  const flavorText=flavorObj?(typeof flavorObj==='object'?flavorObj.desc:flavorObj):null;

  app().innerHTML=`
  <div class="fade-in">
    <!-- 1. Header — 36 프로필 통합 아이덴티티 -->
    <div style="text-align:center;padding:32px 0 20px">
      <p style="font-size:14px;color:#9CA3AF;margin-bottom:8px;font-weight:500">당신의 HRBP 프로필은</p>
      <div style="font-size:52px;margin-bottom:8px">${t.emoji}</div>
      ${flavorObj&&typeof flavorObj==='object'?`
        <h1 style="font-size:28px;font-weight:800;color:${t.color};margin-bottom:4px;letter-spacing:-.5px">${fl?fl.icon+' ':''}<span>${flavorObj.name}</span></h1>
        <p style="font-size:14px;color:#6B7280;font-weight:500;margin-bottom:2px">${t.name} × ${fl?fl.name:fk}</p>
      `:`
        <h1 style="font-size:30px;font-weight:800;color:${t.color};margin-bottom:6px;letter-spacing:-.5px">${t.name}</h1>
      `}
      <p style="font-size:15px;color:#6B7280;font-weight:500">${t.subtitle}</p>
    </div>

    <!-- 2. 통합 프로필 설명 (4축 융합) -->
    ${flavorObj&&typeof flavorObj==='object'?`
    <div class="card" style="border:2px solid ${t.colorLight}">
      <div class="sec-title">🎯 나의 프로필</div>
      <p style="font-size:15px;color:#374151;line-height:1.8;margin-bottom:14px">${flavorObj.desc}</p>
      <div style="display:flex;gap:8px;margin-bottom:14px">
        <div style="flex:1;padding:12px;background:#F0FDF4;border-radius:10px;border:1px solid #BBF7D0">
          <p style="font-size:12px;font-weight:700;color:#059669;margin-bottom:4px">💪 강점</p>
          <p style="font-size:13px;color:#374151;line-height:1.6">${flavorObj.strength}</p>
        </div>
        <div style="flex:1;padding:12px;background:#FFFBEB;border-radius:10px;border:1px solid #FDE68A">
          <p style="font-size:12px;font-weight:700;color:#92400E;margin-bottom:4px">⚠️ 주의</p>
          <p style="font-size:13px;color:#374151;line-height:1.6">${flavorObj.caution}</p>
        </div>
      </div>
      ${(()=>{
        const axes=[{label:'변화 ↔ 안정',val:state.strengthScores.CS||0,left:'🔥 변화',right:'안정 🛡️',colorL:'#8B5CF6',colorR:'#059669'},
           {label:'데이터 ↔ 직관',val:state.strengthScores.DI||0,left:'📊 데이터',right:'직관 💡',colorL:'#0984E3',colorR:'#F59E0B'}];
        return '<div style="display:flex;gap:10px">'+axes.map(ax=>{
          const pct=Math.min(95,Math.max(5,50+(ax.val/6)*50));
          const isLeft=ax.val<=0;
          const dotColor=isLeft?ax.colorL:ax.colorR;
          return '<div style="flex:1;padding:14px;background:#F9FAFB;border-radius:12px">'+
            '<div style="font-size:11px;color:#9CA3AF;font-weight:600;margin-bottom:6px;text-align:center">'+ax.label+'</div>'+
            '<div style="display:flex;justify-content:space-between;margin-bottom:3px">'+
            '<span style="font-size:10px;font-weight:'+(isLeft?'700':'400')+';color:'+(isLeft?ax.colorL:'#9CA3AF')+'">'+ax.left+'</span>'+
            '<span style="font-size:10px;font-weight:'+(!isLeft?'700':'400')+';color:'+(!isLeft?ax.colorR:'#9CA3AF')+'">'+ax.right+'</span></div>'+
            '<div style="position:relative;height:8px;background:#E5E7EB;border-radius:4px">'+
            '<div style="position:absolute;top:0;bottom:0;left:50%;width:1px;background:#D1D5DB"></div>'+
            '<div style="position:absolute;top:-2px;left:'+pct+'%;transform:translateX(-50%);width:12px;height:12px;border-radius:50%;background:'+dotColor+';border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.2)"></div>'+
            '</div></div>';}).join('')+'</div>';
      })()}
    </div>`:''}

    <div class="card">
      <div class="sec-title">${t.emoji} ${t.name}</div>
      <div style="background:${t.colorBg};border-radius:12px;padding:14px 16px;margin-bottom:16px;border-left:3px solid ${t.color}">
        <p style="font-size:13px;font-weight:700;color:${t.color};margin-bottom:4px">핵심 욕구</p>
        <p style="font-size:15px;color:#374151;line-height:1.7">${t.coreNeed}</p>
      </div>
      <p style="font-size:15px;color:#374151;line-height:1.8;white-space:pre-line">${t.desc}</p>
      <div style="background:#FEF2F2;border-radius:12px;padding:14px 16px;margin-top:16px;border-left:3px solid #F87171">
        <p style="font-size:13px;font-weight:700;color:#DC2626;margin-bottom:4px">이건 절대 못 참아요</p>
        <p style="font-size:14px;color:#374151;line-height:1.7">${t.painPoint}</p>
      </div>
      ${t.keywords?`<div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:16px">${t.keywords.map(k=>`<span style="font-size:12px;padding:5px 10px;background:${t.colorBg};color:${t.color};border-radius:8px;border:1px solid ${t.colorLight};font-weight:600">#${k}</span>`).join("")}</div>`:''}
    </div>

    <!-- 3. Chart -->
    <div class="card">
      <div class="sec-title">📍 나의 위치</div>
      ${makeChart([{name:state.userName||"나",se:state.scores.SE,pt:state.scores.PT,typeKey:tk}])}
      <div style="display:flex;justify-content:center;gap:20px;margin-top:12px">
        <div style="text-align:center"><div style="font-size:11px;color:#9CA3AF;font-weight:600">전략↔실행</div><div style="font-size:18px;font-weight:800;color:${t.color}">${state.scores.SE>0?"+":""}${state.scores.SE}</div></div>
        <div style="width:1px;background:${t.colorLight}"></div>
        <div style="text-align:center"><div style="font-size:11px;color:#9CA3AF;font-weight:600">관계↔과업</div><div style="font-size:18px;font-weight:800;color:${t.color}">${state.scores.PT>0?"+":""}${state.scores.PT}</div></div>
      </div>
    </div>

    <!-- 4. Energy Map -->
    <div class="card">
      <div class="sec-title">⚡ 에너지 맵</div>
      <div style="margin-bottom:14px">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
          <span style="background:#ECFDF5;color:#059669;font-size:12px;font-weight:700;padding:4px 10px;border-radius:8px">🔋 에너지 UP</span>
        </div>
        <div style="display:flex;flex-wrap:wrap;gap:6px">${t.energyUp.map(x=>`<span class="tag tag-green">${x}</span>`).join("")}</div>
      </div>
      <div style="height:1px;background:#F3F4F6;margin-bottom:14px"></div>
      <div>
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
          <span style="background:#FEF2F2;color:#DC2626;font-size:12px;font-weight:700;padding:4px 10px;border-radius:8px">🪫 에너지 DOWN</span>
        </div>
        <div style="display:flex;flex-wrap:wrap;gap:6px">${t.energyDown.map(x=>`<span class="tag tag-red">${x}</span>`).join("")}</div>
      </div>
    </div>

    <!-- (플레이버 섹션은 통합 프로필 카드에 병합됨) -->

    <!-- 5b. Phase-based Task Fit -->
    <div class="card">
      <div class="sec-title">📋 과업 단계별 적합도</div>
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:14px">하나의 HR 프로젝트를 5단계로 나눴을 때, 내가 빛나는 단계는?</p>
      ${TASK_PHASES.map(p=>{
        const isBest=p.bestTypes.includes(tk);
        const isGood=p.goodTypes.includes(tk);
        const level=isBest?'best':isGood?'good':'neutral';
        const bg=level==='best'?t.colorBg:level==='good'?'#F0FDF4':'#F9FAFB';
        const border=level==='best'?t.colorLight:level==='good'?'#BBF7D0':'#E5E7EB';
        const badge=level==='best'?'⭐ 최적':level==='good'?'👍 잘 맞음':'';
        return`
        <div style="padding:12px 14px;border:1px solid ${border};border-radius:12px;margin-bottom:8px;background:${bg}">
          <div style="display:flex;align-items:center;gap:8px">
            <span style="font-size:18px">${p.icon}</span>
            <div style="flex:1">
              <div style="font-size:14px;font-weight:700;color:#374151">${p.name}</div>
              <div style="font-size:12px;color:#9CA3AF">${p.desc}</div>
            </div>
            ${badge?`<span style="font-size:11px;font-weight:700;padding:3px 8px;border-radius:6px;background:${level==='best'?t.color:'#059669'};color:#fff;white-space:nowrap">${badge}</span>`:''}
          </div>
        </div>`;}).join("")}
    </div>

    <!-- 6. User Manual (5항목: 요청/피드백/피해주세요/스트레스/과부하&회복) -->
    <div class="card" style="border:2px solid ${t.color}">
      <div class="sec-title">📋 나의 사용설명서</div>
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:14px;margin-top:-8px">팀 노션에 붙여놓고 참고하세요</p>
      ${[{icon:"📨",label:"나에게 업무 요청할 때",text:t.manual.request},{icon:"💬",label:"나에게 피드백 줄 때",text:t.manual.feedback},{icon:"🚫",label:"이건 피해주세요",text:t.manual.avoid},{icon:"😰",label:"스트레스 신호",text:t.manual.stress},{icon:"💚",label:"과부하일 때 이렇게 도와주세요",text:t.manual.overload}].map((item,i)=>`
        <div style="padding:14px 16px;background:${i===4?"#ECFDF5":i%2===0?t.colorBg:"#FAFAFA"};border-radius:12px;margin-bottom:${i<4?10:0}px">
          <div style="font-size:13px;font-weight:700;color:${i===4?"#059669":t.color};margin-bottom:6px">${item.icon} ${item.label}</div>
          <p style="font-size:14px;color:#374151;line-height:1.7">${item.text}</p>
        </div>`).join("")}
    </div>

    <!-- 7. Compatibility (한 줄 요약) -->
    <div class="card">
      <div class="sec-title">🤝 유형 궁합</div>
      <div style="display:flex;gap:10px">
        <div style="flex:1;background:#F0FDF4;border-radius:12px;padding:14px;border:1px solid #BBF7D0;text-align:center">
          <p style="font-size:12px;font-weight:600;color:#059669;margin-bottom:6px">시너지</p>
          <p style="font-size:15px;font-weight:800;color:#166534">${t.bestMatchShort}</p>
        </div>
        <div style="flex:1;background:#FFFBEB;border-radius:12px;padding:14px;border:1px solid #FDE68A;text-align:center">
          <p style="font-size:12px;font-weight:600;color:#92400E;margin-bottom:6px">주의</p>
          <p style="font-size:15px;font-weight:800;color:#92400E">${t.tensionMatchShort}</p>
        </div>
      </div>
      <p style="font-size:12px;color:#9CA3AF;text-align:center;margin-top:10px">팀 조합에서 상세 1:1 소통 가이드를 확인하세요</p>
    </div>

    <!-- Share buttons -->
    ${!state.sharedResult?`
    <div style="display:flex;gap:8px;margin-bottom:16px">
      <button class="btn btn-secondary" onclick="shareMyResult()" id="shareResultBtn" style="font-size:14px;flex:1">🔗 내 결과 공유</button>
      <button class="btn btn-secondary" onclick="shareTestLink()" id="shareTestBtn" style="font-size:14px;flex:1">📨 테스트 공유</button>
    </div>`:''}

    <!-- Team CTA -->
    ${state.sharedResult?`
    <div class="card" style="text-align:center;background:linear-gradient(135deg,#F3F0FF 0%,#EBF5FF 100%);border:2px solid #C4B5FD">
      <div style="font-size:36px;margin-bottom:8px">🧭</div>
      <p style="font-size:16px;font-weight:700;color:#374151;margin-bottom:8px">나도 궁금하다면?</p>
      <button class="btn btn-primary" onclick="location.href=location.pathname" style="margin-top:8px">나도 테스트하기</button>
    </div>
    `:state.mode==="team"?`
    <button class="btn btn-primary" onclick="goTeam()" style="width:100%;margin-bottom:12px">👥 팀 결과 보기</button>
    <button class="btn btn-secondary" onclick="restart()" style="width:100%;margin-bottom:16px">다시 테스트</button>
    `:`
    ${sb?`
    <div class="card" style="text-align:center;background:linear-gradient(135deg,#F3F0FF 0%,#EBF5FF 100%);border:2px solid #C4B5FD">
      <div style="font-size:36px;margin-bottom:8px">👥</div>
      <p style="font-size:16px;font-weight:700;color:#374151;margin-bottom:6px">우리 팀 조합도 알아보세요</p>
      <p style="font-size:13px;color:#6B7280;line-height:1.6;margin-bottom:16px">팀을 만들고 링크를 공유하면, 팀원들이<br>테스트를 하는 대로 자동으로 결과가 모여요</p>
      <div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:16px">
        ${[["📊","팀 유형 분포 & 밸런스"],["🤝","1:1 맞춤 소통 가이드"],["📋","과업별 리드/서포트 추천"]].map(([i,t])=>`<span style="font-size:12px;padding:6px 12px;background:#fff;border:1px solid #E5E7EB;border-radius:10px;color:#374151">${i} ${t}</span>`).join("")}
      </div>
      <button class="btn btn-primary" onclick="goCreateTeam()">우리 팀 만들기</button>
    </div>`:``}
    <button class="btn btn-secondary" onclick="restart()" style="width:100%;margin-bottom:16px">다시 테스트</button>
    `}
    <button onclick="resetAllData()" style="margin-top:8px;background:none;border:none;font-size:12px;color:#D1D5DB;cursor:pointer;font-family:inherit;padding:8px">🗑️ 데이터 초기화</button>
    <div style="height:32px"></div>
  </div>`;
}

function renderTeamLoading(){
  app().innerHTML=`
  <div class="fade-in" style="padding-top:80px;text-align:center">
    <div style="margin-bottom:16px"><span class="spinner"></span></div>
    <h2 style="font-size:18px;font-weight:700;margin-bottom:8px">팀 결과를 불러오는 중...</h2>
    <p style="font-size:14px;color:#6B7280">${state.teamName?'"'+state.teamName+'" 팀':''}</p>
  </div>`;
}
async function loadTeamFromSupabase(){
  try{
    const results=await sbLoadResults(state.teamId);
    state.members=results.map(r=>{
      let cs=0,di=0;
      if(Array.isArray(r.strength_answers)){
        r.strength_answers.forEach(s=>{const[k,v]=s.split(':');if(k==='CS')cs=parseInt(v)||0;if(k==='DI')di=parseInt(v)||0;});
      }
      return{name:r.name,se:r.se_score,pt:r.pt_score,typeKey:r.type_key,cs,di};
    });
    // Auto-save my result if I have scores but I'm not in the team results
    if(state.userName&&state.scores&&state.scores.SE!==undefined){
      const myName=state.userName;
      const found=state.members.find(m=>m.name===myName);
      if(!found){
        const tk=typeFromScores(state.scores.SE,state.scores.PT);
        const ssData={CS:state.strengthScores?.CS||0,DI:state.strengthScores?.DI||0};
        try{
          await sbSaveResult(state.teamId,myName,state.scores.SE,state.scores.PT,tk,ssData);
          state.members.push({name:myName,se:state.scores.SE,pt:state.scores.PT,typeKey:tk,cs:ssData.CS,di:ssData.DI});
          saveTeamMembership(state.teamId,myName);
        }catch(e2){/* silent */}
      }
    }
    state._teamLoaded=true;
    render();
  }catch(e){
    app().innerHTML=`
    <div class="fade-in" style="padding-top:80px;text-align:center">
      <div style="font-size:48px;margin-bottom:16px">😢</div>
      <h2 style="font-size:18px;font-weight:700;margin-bottom:8px">팀 결과를 불러오지 못했어요</h2>
      <p style="font-size:14px;color:#6B7280;margin-bottom:24px">${e.message}</p>
      <button class="btn btn-primary" onclick="state._teamLoaded=false;render()">다시 시도</button>
      <button class="btn btn-secondary" onclick="state.screen='intro';render()" style="margin-top:10px">처음으로</button>
    </div>`;
  }
}

function renderTeam(){
  // Supabase team: auto-load results
  if(state.mode==="team"&&state.teamId&&sb&&!state._teamLoaded){
    renderTeamLoading();loadTeamFromSupabase();return;
  }
  const myTk=typeFromScores(state.scores.SE,state.scores.PT);
  if(state.members.length===0){
    if(state.userName){state.members=[{name:state.userName,se:state.scores.SE,pt:state.scores.PT,typeKey:myTk}];}
    else{state.members=[{name:"나",se:0,pt:0,typeKey:"allrounder"}];}
  }

  // Type counts
  const typeCounts={};
  state.members.forEach(m=>{typeCounts[m.typeKey]=(typeCounts[m.typeKey]||0)+1;});
  const missing=TYPES.filter(t=>!typeCounts[t]);

  app().innerHTML=`
  <div class="fade-in">
    ${state.userName?`<button onclick="goResult()" style="display:flex;align-items:center;gap:6px;font-size:14px;color:#6B7280;background:none;border:none;cursor:pointer;padding:12px 0;font-weight:600;font-family:inherit">← 내 결과로 돌아가기</button>`:''}
    <h2 style="font-size:24px;font-weight:800;margin-bottom:8px">👥 ${state.mode==="team"&&state.teamName?state.teamName+' ':''} 팀 조합 분석</h2>
    <p style="font-size:14px;color:#9CA3AF;margin-bottom:24px">${state.mode==="team"?'팀원들이 테스트를 완료하면 자동으로 여기에 나타나요':'팀원들의 공유 코드를 붙여넣어 한눈에 비교하세요'}</p>

    <!-- Chart -->
    <div class="card">${makeChart(state.members,320)}</div>

    <!-- ① Team Meeting Guide -->
    ${state.members.length>1?`
    <div class="card" style="border:2px solid #C4B5FD;background:linear-gradient(135deg,#FAFBFF 0%,#F3F0FF 100%)">
      <div class="sec-title">🗣️ 우리 팀 회의 가이드</div>
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:14px">팀 유형 조합을 분석해서 만든 맞춤 가이드예요</p>
      ${analyzeTeamComposition(state.members).map(tip=>`
        <div style="padding:14px;background:#fff;border-radius:12px;margin-bottom:8px;border:1px solid #E5E7EB">
          <p style="font-size:14px;color:#374151;line-height:1.7"><span style="font-size:16px;margin-right:4px">${tip.icon}</span>${tip.text}</p>
        </div>`).join("")}
    </div>`:""}

    <!-- ② Conflict Prediction -->
    ${(()=>{
      if(state.members.length<2)return'';
      const conflicts=findConflictPairs(state.members);
      const allPairs=[];
      for(let i=0;i<state.members.length;i++)for(let j=i+1;j<state.members.length;j++)allPairs.push([i,j]);
      const conflictNames=new Set(conflicts.map(c=>c.a.name+'-'+c.b.name));
      const okPairs=allPairs.filter(([i,j])=>!conflictNames.has(state.members[i].name+'-'+state.members[j].name));
      return`
    <div class="card">
      <div class="sec-title">⚡ 갈등 예측 & 시너지</div>
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:14px">마찰 가능성이 높은 조합만 골라 보여드려요</p>
      ${conflicts.length>0?conflicts.map(c=>{
        const tA=T[c.a.typeKey],tB=T[c.b.typeKey];
        return`
        <div style="border:1px solid #FECACA;border-radius:14px;padding:16px;margin-bottom:12px;background:#FEF2F222">
          <div style="display:flex;align-items:center;gap:6px;margin-bottom:10px;flex-wrap:wrap">
            <span style="font-size:11px;font-weight:700;color:#DC2626;background:#FEE2E2;padding:3px 8px;border-radius:6px">⚠️ 주의 조합</span>
            <span style="font-size:14px;font-weight:700;color:#374151">${tA.emoji} ${c.a.name}</span>
            <span style="font-size:12px;color:#9CA3AF">↔</span>
            <span style="font-size:14px;font-weight:700;color:#374151">${tB.emoji} ${c.b.name}</span>
          </div>
          <p style="font-size:13px;color:#374151;line-height:1.7;margin-bottom:10px">${c.reason}</p>
          <div style="padding:10px 12px;background:#F0FDF4;border-radius:10px;border:1px solid #BBF7D0">
            <span style="font-size:12px;font-weight:700;color:#059669">💡 이렇게 풀어보세요</span>
            <p style="font-size:13px;color:#374151;line-height:1.6;margin-top:4px">${c.tip}</p>
          </div>
        </div>`;}).join(''):`
        <div style="padding:16px;background:#F0FDF4;border-radius:12px;border:1px solid #BBF7D0;text-align:center">
          <p style="font-size:14px;color:#059669;font-weight:600">✨ 특별한 갈등 리스크가 없는 조합이에요!</p>
        </div>`}
      ${okPairs.length>0?`
      <div style="margin-top:12px;padding:12px;background:#F9FAFB;border-radius:12px">
        <p style="font-size:12px;color:#059669;font-weight:600;margin-bottom:6px">👍 잘 맞는 조합</p>
        <div style="display:flex;flex-wrap:wrap;gap:6px">
          ${okPairs.map(([i,j])=>{const a=state.members[i],b=state.members[j];return`<span style="font-size:12px;padding:4px 10px;background:#F0FDF4;color:#166534;border-radius:8px;border:1px solid #BBF7D0">${T[a.typeKey].emoji} ${a.name} · ${T[b.typeKey].emoji} ${b.name}</span>`;}).join('')}
        </div>
      </div>`:''}
    </div>`;})()}

    <!-- ③ Phase-based Task Assignment -->
    ${state.members.length>1?(()=>{
      const phaseGapTips={
        direction:"방향 설정이 약하면 프로젝트가 '왜 하는지' 모른 채 흘러갈 수 있어요. 킥오프 때 '목적과 기대 효과'를 문서로 명확히 정리하세요.",
        design:"체계 설계 인원이 부족하면 프로세스가 '되는 대로' 흘러가요. 기준과 절차를 미리 문서화하고 체크리스트를 만들어두세요.",
        communication:"소통 담당이 없으면 이해관계자 저항에 부딪힐 수 있어요. 주요 관계자별 설득 포인트를 미리 정리하고, 정기적 업데이트 일정을 잡으세요.",
        execution:"실행 운영에 적합한 인원이 부족해요. 마감과 품질이 흔들릴 수 있으니, 실행 체크리스트를 만들고 주간 진척 체크를 넣으세요.",
        analysis:"데이터 분석 역량이 부족할 수 있어요. 프로젝트 시작 시 '무엇을 측정할지' KPI를 미리 정하고, 간단한 대시보드라도 만들어두세요."
      };
      const phaseWeakTips={
        direction:"최적 인원은 없지만 보조할 수 있는 멤버가 있어요. 방향 설정 회의 때 충분한 논의 시간을 확보하세요.",
        design:"최적 인원 없이 보조 멤버만 있어요. 외부 레퍼런스나 템플릿을 참고해서 체계를 잡으면 보완할 수 있어요.",
        communication:"최적 인원 없이 보조 멤버만 있어요. 소통 채널과 주기를 미리 정해두면 도움이 돼요.",
        execution:"최적 인원 없이 보조 멤버만 있어요. 역할 분담을 명확히 하고 마감 관리를 의식적으로 챙기세요.",
        analysis:"최적 인원 없이 보조 멤버만 있어요. 간단한 서베이/지표 수집이라도 프로젝트 초기에 설계해두세요."
      };
      return`
    <div class="card">
      <div class="sec-title">📋 과업 단계별 팀 배치</div>
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:8px">HR 프로젝트를 5단계로 나눴을 때, 각 단계에 누가 가장 잘 맞을까요?</p>
      <div style="display:flex;gap:12px;margin-bottom:14px;font-size:11px;color:#6B7280">
        <span>⭐ <b>최적 적합</b> — 이 단계의 핵심 역할</span>
        <span>👍 <b>잘 맞음</b> — 보조·지원 가능</span>
      </div>
      ${TASK_PHASES.map(p=>{
        const bestMembers=state.members.filter(m=>p.bestTypes.includes(m.typeKey));
        const goodMembers=state.members.filter(m=>p.goodTypes.includes(m.typeKey));
        const hasGap=bestMembers.length===0&&goodMembers.length===0;
        const weakGap=bestMembers.length===0&&goodMembers.length>0;
        return`
        <div style="border:1px solid ${hasGap?'#FECACA':weakGap?'#FDE68A':'#E5E7EB'};border-radius:14px;padding:14px;margin-bottom:10px;background:${hasGap?'#FEF2F211':weakGap?'#FFFBEB11':'#FAFBFF'}">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
            <span style="font-size:18px">${p.icon}</span>
            <div style="flex:1">
              <div style="font-size:14px;font-weight:700;color:#374151">${p.name}</div>
              <div style="font-size:11px;color:#9CA3AF">${p.desc}</div>
            </div>
            ${hasGap?'<span style="font-size:10px;font-weight:700;color:#DC2626;background:#FEE2E2;padding:2px 8px;border-radius:6px">GAP</span>':weakGap?'<span style="font-size:10px;font-weight:700;color:#92400E;background:#FEF3C7;padding:2px 8px;border-radius:6px">보완 필요</span>':''}
          </div>
          ${bestMembers.length>0?`<div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:4px">
            ${bestMembers.map(m=>`<span style="font-size:12px;padding:4px 10px;background:${T[m.typeKey].colorBg};color:${T[m.typeKey].color};border-radius:8px;border:1px solid ${T[m.typeKey].colorLight};font-weight:700">⭐ ${m.name}</span>`).join('')}
          </div>`:''}
          ${goodMembers.length>0?`<div style="display:flex;flex-wrap:wrap;gap:4px">
            ${goodMembers.map(m=>`<span style="font-size:12px;padding:4px 10px;background:#F3F4F6;color:#6B7280;border-radius:8px;border:1px solid #E5E7EB">👍 ${m.name}</span>`).join('')}
          </div>`:''}
          ${hasGap?`<div style="margin-top:8px;padding:10px 12px;background:#FEF2F2;border-radius:10px;border:1px solid #FECACA">
            <p style="font-size:12px;color:#991B1B;line-height:1.6"><b>⚠️ ${phaseGapTips[p.id]}</b></p>
          </div>`:''}
          ${weakGap?`<div style="margin-top:8px;padding:10px 12px;background:#FFFBEB;border-radius:10px;border:1px solid #FDE68A">
            <p style="font-size:12px;color:#92400E;line-height:1.6">${phaseWeakTips[p.id]}</p>
          </div>`:''}
          ${(()=>{
            if(!p.styleFit)return'';
            const hasCS=state.members.some(m=>m.cs!==undefined&&m.cs!==null);
            if(!hasCS)return'';
            const sf=p.styleFit;
            const styleMatch=state.members.filter(m=>{
              let fit=true;
              if(sf.cs==='change')fit=fit&&(m.cs||0)<0;
              if(sf.cs==='stable')fit=fit&&(m.cs||0)>0;
              if(sf.di==='data')fit=fit&&(m.di||0)<0;
              if(sf.di==='intuition')fit=fit&&(m.di||0)>0;
              return fit;
            });
            if(styleMatch.length===0)return`<div style="margin-top:6px;font-size:11px;color:#9CA3AF;line-height:1.5">💡 ${sf.note} — 이 팀에선 해당 스타일이 없어서 의식적으로 보완하세요.</div>`;
            return`<div style="margin-top:6px;font-size:11px;color:#6B7280;line-height:1.5">💡 ${sf.note}: <b>${styleMatch.map(m=>m.name).join(', ')}</b></div>`;
          })()}
        </div>`;}).join('')}
    </div>`;})():""}

    <!-- ④ My Communication Guide -->
    ${(()=>{
      const meIdx=state.members.findIndex(m=>m.name===state.userName);
      const me=meIdx>=0?state.members[meIdx]:null;
      const others=me?state.members.filter((_,i)=>i!==meIdx):[];
      if(!me||others.length===0)return'';
      const myBase=getBaseType(me.typeKey);
      return`
    <div class="card">
      <div class="sec-title">💬 나의 소통 가이드</div>
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:14px">내가 각 팀원에게 다가갈 때 참고하세요</p>
      ${others.map(other=>{
        const key=myBase+">"+getBaseType(other.typeKey);
        const guide=REL_GUIDE[key]||REL_GUIDE[myBase+">"+myBase];
        const ot=T[other.typeKey];
        return`
        <div style="border:1px solid ${ot.colorLight};border-radius:14px;padding:14px;margin-bottom:10px;background:${ot.colorBg}22">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
            <span style="font-size:18px">${ot.emoji}</span>
            <div style="flex:1">
              <span style="font-size:14px;font-weight:700;color:${ot.color}">${other.name}</span>
              <span style="font-size:11px;color:#9CA3AF;margin-left:4px">${ot.name}</span>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">
            <div style="padding:8px 10px;background:#fff;border-radius:8px"><span style="font-size:11px;font-weight:700;color:${ot.color}">📨 요청할 때</span><p style="font-size:12px;color:#374151;line-height:1.5;margin-top:3px">${guide.req}</p></div>
            <div style="padding:8px 10px;background:#fff;border-radius:8px"><span style="font-size:11px;font-weight:700;color:${ot.color}">💬 피드백할 때</span><p style="font-size:12px;color:#374151;line-height:1.5;margin-top:3px">${guide.fb}</p></div>
            <div style="padding:8px 10px;background:#FEF2F2;border-radius:8px"><span style="font-size:11px;font-weight:700;color:#DC2626">⚠️ 주의</span><p style="font-size:12px;color:#374151;line-height:1.5;margin-top:3px">${guide.warn}</p></div>
            <div style="padding:8px 10px;background:#F0FDF4;border-radius:8px"><span style="font-size:11px;font-weight:700;color:#059669">✨ 시너지</span><p style="font-size:12px;color:#374151;line-height:1.5;margin-top:3px">${guide.synergy}</p></div>
          </div>
          ${(other.cs!==undefined&&other.cs!==null)?(()=>{
            const tips=[];
            const oCS=other.cs||0,oD=other.di||0;
            const mCS=me.cs||0,mD=me.di||0;
            if(oD<0)tips.push('📊 데이터형 — 제안할 때 숫자 근거를 먼저 보여주세요');
            if(oD>0)tips.push('💡 직관형 — 현장 사례와 경험담으로 접근하면 잘 통해요');
            if(oCS<0&&mCS>=0)tips.push('🔄 변화 추구형 — 새로운 시도에 열려있으니 혁신 아이디어를 함께 논의해보세요');
            if(oCS>0&&mCS<=0)tips.push('🛡️ 안정 추구형 — 변화를 제안할 땐 기존 체계 존중하면서 단계적으로 접근하세요');
            if(oCS<0&&mCS<0)tips.push('🔄 둘 다 변화형 — 함께 새로운 시도를 밀어붙일 수 있지만, 리스크 체크를 서로 챙겨주세요');
            if(oCS>0&&mCS>0)tips.push('🛡️ 둘 다 안정형 — 안정적이지만 변화가 필요할 때 서로 용기를 줄 수 있어요');
            return tips.length>0?`
          <div style="margin-top:8px;padding:8px 10px;background:#F3F0FF;border-radius:8px;border:1px solid #E5E7EB">
            <span style="font-size:10px;font-weight:700;color:#6C5CE7">🎨 업무 스타일 팁</span>
            ${tips.map(t=>`<p style="font-size:11px;color:#374151;line-height:1.5;margin-top:3px">${t}</p>`).join('')}
          </div>`:'';
          })():''}
        </div>`;}).join('')}
    </div>`;})()}

    <!-- Member List (clickable for detail) -->
    <div class="card">
      <div class="sec-title">👤 팀원 목록</div>
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:12px">팀원을 눌러 유형 상세를 확인하세요</p>
      ${state.members.map((m,i)=>{const isMe=m.name===state.userName;const t=T[m.typeKey];const isOpen=state._viewMemberIdx===i;return`
        <div style="border:1px solid ${isOpen?t.colorLight:'#E5E7EB'};border-radius:14px;margin-bottom:8px;overflow:hidden;transition:all .15s">
          <div onclick="toggleMemberDetail(${i})" style="display:flex;align-items:center;gap:10px;padding:12px 14px;background:${isOpen?t.colorBg:(isMe?t.colorBg+'88':'#F9FAFB')};cursor:pointer">
            <span style="font-size:20px">${t.emoji}</span>
            <div style="flex:1">
              <div style="font-size:14px;font-weight:700;color:#1A1A2E">${m.name} ${isMe?`<span style="font-size:11px;color:${t.color};font-weight:600">(나)</span>`:""}</div>
              <div style="font-size:12px;color:#9CA3AF">${(()=>{if(m.cs===undefined||m.cs===null)return t.name;const _fk=getFlavorKey(m.cs,m.di||0);const _fl=FLAVOR_LABELS[_fk];const _fo=t.flavor?t.flavor[_fk]:null;const _fn=_fo&&typeof _fo==='object'?_fo.name:(_fl?_fl.name:'');return _fn?(_fl?_fl.icon+' ':'')+_fn+' · '+t.name:t.name;})()}</div>
            </div>
            ${state.mode!=="team"&&i>0?`<button onclick="event.stopPropagation();removeMember(${i})" style="background:none;border:none;cursor:pointer;font-size:16px;color:#D1D5DB;padding:4px">✕</button>`:""}
            <span style="font-size:12px;color:#9CA3AF;transition:transform .15s;${isOpen?'transform:rotate(90deg)':''}">${isOpen?'▾':'▸'}</span>
          </div>
          ${isOpen?`
          <div style="padding:16px;border-top:1px solid ${t.colorLight}">
            <p style="font-size:15px;font-weight:700;color:${t.color};margin-bottom:4px">${t.subtitle}</p>
            ${(m.cs!==undefined&&m.cs!==null&&t.flavor)?(()=>{
              const fk=getFlavorKey(m.cs,m.di||0);
              const fl=FLAVOR_LABELS[fk];
              const flObj=t.flavor[fk];
              const flText=flObj?(typeof flObj==='object'?flObj.desc:flObj):'';
              const flName=flObj&&typeof flObj==='object'?flObj.name:(fl?fl.name:'');
              const flStrength=flObj&&typeof flObj==='object'?flObj.strength:'';
              const flCaution=flObj&&typeof flObj==='object'?flObj.caution:'';
              return fl?`
            <div style="padding:12px;background:linear-gradient(135deg,${t.colorBg},#fff);border-radius:12px;border:1px solid ${t.colorLight};margin-bottom:12px">
              <div style="display:flex;align-items:center;gap:6px;margin-bottom:6px">
                <span style="font-size:16px">${fl.icon}</span>
                <span style="font-size:13px;font-weight:700;color:${t.color}">${flName}</span>
                <span style="font-size:11px;color:#9CA3AF">${t.name}</span>
              </div>
              ${flText?`<p style="font-size:12px;color:#374151;line-height:1.6;margin-bottom:6px">${flText}</p>`:''}
              ${flStrength?`<div style="display:flex;gap:6px">${flStrength?`<span style="font-size:11px;padding:3px 8px;background:#F0FDF4;color:#166534;border-radius:6px;border:1px solid #BBF7D0">💪 ${flStrength}</span>`:''}</div>`:''}
              <div style="display:flex;gap:8px;margin-top:8px">
                ${[{val:m.cs,left:'변화',right:'안정',cL:'#8B5CF6',cR:'#059669'},
                   {val:m.di||0,left:'데이터',right:'직관',cL:'#0984E3',cR:'#F59E0B'}
                ].map(ax=>{
                  const pct=Math.min(95,Math.max(5,50+(ax.val/6)*50));
                  const isL=ax.val<=0;
                  return`<div style="flex:1">
                  <div style="display:flex;justify-content:space-between;font-size:10px;margin-bottom:2px"><span style="color:${isL?ax.cL:'#9CA3AF'};font-weight:${isL?'700':'400'}">${ax.left}</span><span style="color:${!isL?ax.cR:'#9CA3AF'};font-weight:${!isL?'700':'400'}">${ax.right}</span></div>
                  <div style="position:relative;height:6px;background:#E5E7EB;border-radius:3px">
                    <div style="position:absolute;top:0;bottom:0;left:50%;width:1px;background:#D1D5DB"></div>
                    <div style="position:absolute;top:-3px;left:${pct}%;transform:translateX(-50%);width:10px;height:10px;border-radius:50%;background:${isL?ax.cL:ax.cR};border:2px solid #fff;box-shadow:0 1px 3px rgba(0,0,0,.15)"></div>
                  </div>
                </div>`;}).join('')}
              </div>
            </div>`:''})():''}
            <div style="padding:12px;background:#FFFBEB;border-radius:10px;border:1px solid #FDE68A;margin-bottom:12px">
              <span style="font-size:12px;font-weight:700;color:#92400E">🔥 핵심 욕구</span>
              <p style="font-size:13px;color:#374151;line-height:1.6;margin-top:4px">${t.coreNeed}</p>
            </div>
            <p style="font-size:13px;color:#374151;line-height:1.7;margin-bottom:12px;white-space:pre-line">${t.desc}</p>
            <div style="padding:12px;background:#FEF2F2;border-radius:10px;border:1px solid #FECACA;margin-bottom:12px">
              <span style="font-size:12px;font-weight:700;color:#DC2626">🚫 이건 절대 못 참아요</span>
              <p style="font-size:13px;color:#374151;line-height:1.6;margin-top:4px">${t.painPoint}</p>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
              <div>
                <span style="font-size:12px;font-weight:700;color:#059669">🔋 에너지 UP</span>
                <div style="margin-top:6px">${t.energyUp.slice(0,4).map(x=>`<div style="font-size:12px;padding:4px 8px;background:#F0FDF4;color:#166534;border-radius:6px;margin-bottom:3px">${x}</div>`).join('')}</div>
              </div>
              <div>
                <span style="font-size:12px;font-weight:700;color:#DC2626">🪫 에너지 DOWN</span>
                <div style="margin-top:6px">${t.energyDown.slice(0,4).map(x=>`<div style="font-size:12px;padding:4px 8px;background:#FEF2F2;color:#991B1B;border-radius:6px;margin-bottom:3px">${x}</div>`).join('')}</div>
              </div>
            </div>
            <div style="background:#F9FAFB;border-radius:10px;padding:12px">
              <span style="font-size:12px;font-weight:700;color:#374151">📋 사용설명서</span>
              ${[{icon:"📨",label:"요청",text:t.manual.request},{icon:"💬",label:"피드백",text:t.manual.feedback},{icon:"🚫",label:"피해주세요",text:t.manual.avoid},{icon:"😰",label:"스트레스 신호",text:t.manual.stress}].map(item=>`
              <div style="margin-top:8px"><span style="font-size:11px;font-weight:600;color:#6B7280">${item.icon} ${item.label}</span><p style="font-size:12px;color:#374151;line-height:1.5;margin-top:2px">${item.text}</p></div>`).join('')}
            </div>
          </div>`:``}
        </div>`;}).join("")}

      <!-- Add members -->
      ${state.mode==="team"?`
      <div style="margin-top:16px;padding:16px;background:#F3F0FF;border-radius:14px;text-align:center;border:1px solid #C4B5FD">
        <p style="font-size:13px;font-weight:600;color:#374151;margin-bottom:8px">팀원 초대하기</p>
        <p style="font-size:12px;color:#9CA3AF;margin-bottom:12px">아래 링크를 팀원에게 공유하세요</p>
        <button class="btn btn-primary" onclick="copyInviteLink()" id="inviteCopyBtn" style="font-size:14px;padding:12px">📋 초대 링크 복사</button>
        <button class="btn btn-secondary" onclick="state._teamLoaded=false;render()" style="margin-top:8px;font-size:13px;padding:10px">🔄 새로고침</button>
      </div>
      `:`
      <div style="margin-top:16px;padding:16px;background:#F9FAFB;border-radius:14px">
        <p style="font-size:13px;font-weight:600;color:#374151;margin-bottom:8px">팀원 코드로 추가</p>
        <p style="font-size:12px;color:#9CA3AF;margin-bottom:12px">팀원이 공유한 코드를 붙여넣으세요. 여러 줄도 가능해요!</p>
        <textarea id="codeInput" class="input" rows="3" placeholder="예시:&#10;김모비:A:-6:3:SP&#10;김민수:D:8:5:ES" style="resize:vertical;margin-bottom:10px"></textarea>
        <button class="btn btn-primary" onclick="addByCode()" style="font-size:14px;padding:12px">+ 코드로 추가</button>
      </div>
      `}
    </div>

    <!-- Team Share Link -->
    ${state.mode==="team"?'':(state.members.length>1?`
    <div class="card" style="text-align:center;background:linear-gradient(135deg,#F3F0FF 0%,#EBF5FF 100%);border:1px solid #C4B5FD">
      <div style="font-size:28px;margin-bottom:8px">🔗</div>
      <p style="font-size:15px;font-weight:700;color:#374151;margin-bottom:6px">팀 공유 링크</p>
      <p style="font-size:12px;color:#9CA3AF;margin-bottom:14px;line-height:1.5">이 링크를 공유하면 누구나 팀 조합 분석을<br>바로 볼 수 있어요 (로그인/입력 필요 없음)</p>
      <button class="btn btn-primary" onclick="copyTeamLink()" id="teamLinkBtn" style="font-size:14px;padding:12px">🔗 팀 링크 복사</button>
    </div>`:"")}

    <!-- All types reference (collapsible) -->
    <div class="card">
      <button onclick="this.nextElementSibling.classList.toggle('hidden');this.querySelector('span:last-child').textContent=this.nextElementSibling.classList.contains('hidden')?'▸':'▾'" style="width:100%;display:flex;align-items:center;justify-content:space-between;background:none;border:none;cursor:pointer;padding:0;font-family:inherit">
        <span class="sec-title" style="margin-bottom:0">📖 9가지 유형 참고</span>
        <span style="font-size:14px;color:#9CA3AF">▸</span>
      </button>
      <div class="hidden" style="margin-top:14px">
        ${TYPES.map(tk=>{const typ=T[tk];return`
          <div style="padding:12px;border-left:3px solid ${typ.color};margin-bottom:8px;background:#FAFAFA;border-radius:0 10px 10px 0">
            <div style="display:flex;align-items:center;gap:8px">
              <span style="font-size:18px">${typ.emoji}</span>
              <span style="font-size:13px;font-weight:700;color:${typ.color}">${typ.name}</span>
              <span style="font-size:11px;color:#9CA3AF">${typ.subtitle}</span>
            </div>
          </div>`;}).join("")}
      </div>
    </div>

    <div style="height:48px"></div>
  </div>`;
}

/* ===== CHART HELPER ===== */
function makeChart(members,size){
  size=size||280;
  let dots=members.map(m=>{
    const x=((m.pt+16)/32)*100;
    const y=((m.se+16)/32)*100;
    const c=T[m.typeKey].color;
    const cx=Math.min(92,Math.max(8,x));
    const cy=Math.min(92,Math.max(8,y));
    return`<div class="dot" style="left:${cx}%;top:${cy}%"><div class="dot-circle" style="background:${c};box-shadow:0 0 0 4px ${c}33,0 2px 8px ${c}44"></div><span class="dot-name" style="color:${c}">${m.name}</span></div>`;
  }).join("");

  return`
  <div class="chart-wrap" style="max-width:${size}px">
    <div class="axis-h"></div><div class="axis-v"></div>
    <div class="chart-quad" style="top:15%;left:17%;color:#6C5CE7;font-size:9px">🏛️ 조직<br>설계자</div>
    <div class="chart-quad" style="top:15%;left:50%;color:#7C6DD8;font-size:9px">🧭 전략<br>기획가</div>
    <div class="chart-quad" style="top:15%;left:83%;color:#0984E3;font-size:9px">⚙️ 전략<br>과업가</div>
    <div class="chart-quad" style="top:50%;left:17%;color:#D35D6E;font-size:9px">💬 관계<br>촉진자</div>
    <div class="chart-quad" style="top:50%;left:50%;color:#8B5CF6;font-size:9px">🎯 올라<br>운더</div>
    <div class="chart-quad" style="top:50%;left:83%;color:#2D8CCA;font-size:9px">📊 과업<br>관리자</div>
    <div class="chart-quad" style="top:85%;left:17%;color:#E17055;font-size:9px">🤝 피플<br>커넥터</div>
    <div class="chart-quad" style="top:85%;left:50%;color:#10B981;font-size:9px">⚡ 현장<br>실행가</div>
    <div class="chart-quad" style="top:85%;left:83%;color:#00B894;font-size:9px">🚀 실행<br>드라이버</div>
    <div class="chart-label" style="top:3px;left:50%;transform:translateX(-50%)">전략형 ↑</div>
    <div class="chart-label" style="bottom:3px;left:50%;transform:translateX(-50%)">↓ 실행형</div>
    <div class="chart-label" style="left:3px;top:50%;transform:translateY(-50%)">관계 ←</div>
    <div class="chart-label" style="right:3px;top:50%;transform:translateY(-50%)">→ 과업</div>
    ${dots}
  </div>`;
}

/* ===== RELATIONSHIP NETWORK ===== */

/* ===== ACTIONS ===== */
function startTest(){
  // Preserve team context when retaking test in team mode
  const keepTeam=state.mode==="team"&&state.teamId;
  const tid=state.teamId,tname=state.teamName;
  state={screen:"questions",qIdx:0,scores:{SE:0,PT:0},strengthScores:{...EMPTY_SS},sqIdx:0,userName:"",members:[],selectedMember:0,
    mode:keepTeam?"team":"solo",teamId:keepTeam?tid:null,teamName:keepTeam?tname:"",loading:false,error:null,_teamLoaded:false,sharedResult:false,_viewMemberIdx:-1};
  render();
}

function answerQ(val,btnIdx){
  const q=QUESTIONS[state.qIdx];
  const actualVal=q.rev?-val:val;
  state.scores[q.axis]+=actualVal;

  // highlight button
  const colors=["#6C5CE7","#A29BFE","#74B9FF","#0984E3"];
  const btns=document.querySelectorAll(".scale-btn");
  btns.forEach((b,i)=>{b.style.pointerEvents="none";});
  btns[btnIdx].style.background=colors[btnIdx];
  btns[btnIdx].style.borderColor=colors[btnIdx];
  btns[btnIdx].style.boxShadow=`0 0 0 4px ${colors[btnIdx]}33`;
  btns[btnIdx].classList.add("selected");

  setTimeout(()=>{
    if(state.qIdx+1<QUESTIONS.length){state.qIdx++;state.screen="questions";}
    else{state.sqIdx=0;state.screen="strength";}
    render();
  },450);
}

function answerSQ(val,btnIdx){
  const sq=STRENGTH_QUESTIONS[state.sqIdx];
  // A(negative axis end) ← negative val, B(positive axis end) ← positive val
  state.strengthScores[sq.axis]+=val;

  // highlight (same animation as answerQ)
  const colors=["#6C5CE7","#A29BFE","#74B9FF","#0984E3"];
  const btns=document.querySelectorAll(".scale-btn");
  btns.forEach(b=>{b.style.pointerEvents="none";});
  btns[btnIdx].style.background=colors[btnIdx];
  btns[btnIdx].style.borderColor=colors[btnIdx];
  btns[btnIdx].style.boxShadow=`0 0 0 4px ${colors[btnIdx]}33`;
  btns[btnIdx].classList.add("selected");

  setTimeout(()=>{
    if(state.sqIdx+1<STRENGTH_QUESTIONS.length){state.sqIdx++;state.screen="strength";}
    else state.screen="name";
    render();
  },450);
}

async function submitName(){
  const inp=$("nameInput");
  if(inp&&inp.value.trim()){state.userName=inp.value.trim();}
  else if(!state.userName){
    // No name yet
    if(state.mode==="team"){
      // Team mode: name is required, don't allow "나"
      if(inp){inp.style.borderColor='#DC2626';inp.placeholder='이름을 입력해주세요!';setTimeout(()=>{inp.style.borderColor='#E5E7EB';},2000);}
      return;
    }
    state.userName="나";
  }
  saveMyResult();
  state.screen="result";
  render();
  // Supabase save (optimistic — result screen already shown)
  if(state.mode==="team"&&state.teamId&&sb){
    const tk=typeFromScores(state.scores.SE,state.scores.PT);
    const ssData={CS:state.strengthScores.CS||0,DI:state.strengthScores.DI||0};
    try{
      await sbSaveResult(state.teamId,state.userName,state.scores.SE,state.scores.PT,tk,ssData);
      saveTeamMembership(state.teamId,state.userName);
      showToast('결과가 팀에 저장됐어요!');
    }catch(e){
      showToast('저장 실패... 다시 시도합니다.');
      try{await sbSaveResult(state.teamId,state.userName,state.scores.SE,state.scores.PT,tk,ssData);saveTeamMembership(state.teamId,state.userName);showToast('저장 완료!');}
      catch(e2){showToast('저장에 실패했어요. 팀 페이지에서 다시 시도해주세요.');}
    }
  }
}


function goTeam(){state.screen="team";if(state.mode==="team")state._teamLoaded=false;else saveTeam();render();}
function goResult(){state.screen="result";render();}
function restart(){startTest();}
function goSavedResult(){
  if(loadMyResult()){
    loadTeam();
    const savedTeam=loadMyTeamContext();
    if(savedTeam&&sb){state.mode="team";state.teamId=savedTeam.teamId;state.teamName=savedTeam.teamName;}
    state.screen="result";render();
  }
}

/* --- Team flow actions --- */
function goCreateTeam(){state.screen="createTeam";state.error=null;render();}

async function handleCreateTeam(){
  const inp=$("teamNameInput");
  const name=inp?inp.value.trim():'';
  if(!name){inp.style.borderColor='#DC2626';setTimeout(()=>{inp.style.borderColor='#E5E7EB';},2000);return;}
  state.loading=true;state.error=null;render();
  try{
    const team=await sbCreateTeam(name);
    state.mode="team";state.teamId=team.id;state.teamName=team.name;
    saveMyTeamContext(team.id,team.name);
    // Auto-save creator's result to the new team
    if(state.userName&&state.scores){
      const tk=typeFromScores(state.scores.SE,state.scores.PT);
      const ssData={CS:state.strengthScores.CS||0,DI:state.strengthScores.DI||0};
      await sbSaveResult(team.id,state.userName,state.scores.SE,state.scores.PT,tk,ssData);
      saveTeamMembership(team.id,state.userName);
    }
    state.loading=false;state.screen="inviteLink";render();
  }catch(e){
    state.loading=false;state.error={message:'팀 생성에 실패했어요. 다시 시도해주세요.'};render();
  }
}

function copyInviteLink(){
  const link=location.origin+location.pathname+'?team='+state.teamId;
  const msg=`🧭 나는 어떤 HRBP일까?\n\n"${state.teamName||'우리'}" 팀 HRBP 유형 진단에 초대받았어요!\n22문항 · 약 5분이면 끝나요.\n\n👉 ${link}`;
  copyToClipboard(msg,'inviteCopyBtn','📋 초대 링크 복사');
}

function shareMyResult(){
  const link=getResultShareLink();
  const tk=typeFromScores(state.scores.SE,state.scores.PT);
  const t=T[tk];
  const msg=`🧭 나의 HRBP 유형은 "${t.emoji} ${t.name}"!\n${t.subtitle}\n\n너도 궁금하면 해봐! 22문항 · 약 5분\n👉 ${link}`;
  copyToClipboard(msg,'shareResultBtn','🔗 내 결과 공유');
}

function shareTestLink(){
  const link=location.origin+location.pathname;
  const msg=`🧭 나는 어떤 HRBP일까?\n\n22문항으로 알아보는 나의 HRBP 업무 스타일 진단\n9가지 유형 × 4가지 플레이버 = 36가지 프로필\n약 5분이면 끝나요!\n\n👉 ${link}`;
  copyToClipboard(msg,'shareTestBtn','📨 테스트 공유');
}

function startTeamTest(){
  state.screen="questions";state.qIdx=0;state.scores={SE:0,PT:0};
  state.strengthScores={...EMPTY_SS};state.sqIdx=0;render();
}

function startTeamTestAsJoiner(){
  const inp=$("joinNameInput");
  const name=inp?inp.value.trim():'';
  if(!name){inp.style.borderColor='#DC2626';setTimeout(()=>{inp.style.borderColor='#E5E7EB';},2000);return;}
  state.userName=name;state.screen="questions";state.qIdx=0;
  state.scores={SE:0,PT:0};state.strengthScores={...EMPTY_SS};state.sqIdx=0;render();
}

function goTeamView(){state._teamLoaded=false;state.screen="team";render();}
function goTeamViewDirect(){
  // Go directly to team view without taking test (for those who already completed it or just want to see results)
  state._teamLoaded=false;state.screen="team";render();
}

function saveTeamMembership(teamId,userName){
  try{localStorage.setItem('hrbp_tm_'+teamId,JSON.stringify({userName,ts:Date.now()}));}catch(e){}
}
function getTeamMembership(teamId){
  try{const d=JSON.parse(localStorage.getItem('hrbp_tm_'+teamId));return d?d.userName:null;}catch(e){return null;}
}
function saveMyTeamContext(teamId,teamName){
  try{localStorage.setItem('hrbp_my_team',JSON.stringify({teamId,teamName,ts:Date.now()}));}catch(e){}
}
function loadMyTeamContext(){
  try{const d=JSON.parse(localStorage.getItem('hrbp_my_team'));if(d&&d.teamId)return d;}catch(e){}
  // Fallback: scan for any hrbp_tm_ membership key
  try{
    let best=null;
    for(let i=0;i<localStorage.length;i++){
      const k=localStorage.key(i);
      if(k&&k.startsWith('hrbp_tm_')){
        const d=JSON.parse(localStorage.getItem(k));
        if(d&&d.ts&&(!best||d.ts>best.ts))best={teamId:k.slice(8),ts:d.ts};
      }
    }
    if(best)return{teamId:best.teamId,teamName:null};
  }catch(e){}
  return null;
}

function resetAllData(){
  if(!confirm('저장된 결과와 팀 정보가 모두 삭제돼요. 계속할까요?'))return;
  Object.keys(localStorage).filter(k=>k.startsWith('hrbp')).forEach(k=>localStorage.removeItem(k));
  location.reload();
}

function showToast(msg){
  let t=document.getElementById('toast');
  if(!t){t=document.createElement('div');t.id='toast';t.style.cssText='position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#1A1A2E;color:#fff;padding:12px 24px;border-radius:12px;font-size:14px;font-family:inherit;z-index:9999;box-shadow:0 4px 16px rgba(0,0,0,.2);transition:opacity .3s';document.body.appendChild(t);}
  t.textContent=msg;t.style.opacity='1';
  clearTimeout(t._timer);t._timer=setTimeout(()=>{t.style.opacity='0';},3000);
}

function copyToClipboard(text,btnId,originalText){
  navigator.clipboard.writeText(text).then(()=>{
    const btn=$(btnId);if(btn){btn.textContent='✅ 복사 완료!';setTimeout(()=>{btn.textContent=originalText;},2000);}
  }).catch(()=>{
    const ta=document.createElement('textarea');ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);
    const btn=$(btnId);if(btn){btn.textContent='✅ 복사 완료!';setTimeout(()=>{btn.textContent=originalText;},2000);}
  });
}
function copyTeamLink(){
  const link=getTeamLink();
  navigator.clipboard.writeText(link).then(()=>{
    const btn=$("teamLinkBtn");btn.textContent="✅ 복사 완료!";
    setTimeout(()=>{btn.textContent="🔗 팀 링크 복사";},2000);
  }).catch(()=>{
    const ta=document.createElement("textarea");ta.value=link;document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta);
    const btn=$("teamLinkBtn");btn.textContent="✅ 복사 완료!";
    setTimeout(()=>{btn.textContent="🔗 팀 링크 복사";},2000);
  });
}

function toggleMemberDetail(idx){
  state._viewMemberIdx=state._viewMemberIdx===idx?-1:idx;
  skipScroll=true;
  render();
}

function removeMember(idx){
  if(idx===0)return;
  state.members.splice(idx,1);
  if(state.selectedMember>=state.members.length)state.selectedMember=0;
  saveTeam();
  skipScroll=true;
  render();
}

function addByCode(){
  const input=$("codeInput");
  if(!input||!input.value.trim())return;
  const lines=input.value.trim().split("\n");
  const codeMap={A:"architect",S:"strategist",B:"builder",F:"facilitator",X:"allrounder",M:"taskmaster",C:"connector",E:"executor",D:"driver"};
  let added=0;
  lines.forEach(line=>{
    const parts=line.trim().split(":");
    if(parts.length>=4){
      const name=parts[0].trim();
      const typeCode=parts[1].trim().toUpperCase();
      const se=parseInt(parts[2]);
      const pt=parseInt(parts[3]);
      if(name&&codeMap[typeCode]&&!isNaN(se)&&!isNaN(pt)){
        // check duplicate
        if(!state.members.find(m=>m.name===name)){
          state.members.push({name,se:Math.max(-16,Math.min(16,se)),pt:Math.max(-16,Math.min(16,pt)),typeKey:codeMap[typeCode]});
          added++;
        }
      }
    }
  });
  if(added>0){input.value="";saveTeam();skipScroll=true;render();}
  else{input.style.borderColor="#DC2626";setTimeout(()=>{input.style.borderColor="#E5E7EB";},2000);}
}

/* ===== INIT ===== */
(async function init(){
  const params=new URLSearchParams(location.search);
  const teamIdParam=params.get('team');

  if(teamIdParam&&sb){
    // Opening an invite link
    state.mode="team";state.teamId=teamIdParam;
    state.screen="teamJoin";state.loading=true;
    render();
    try{
      const team=await sbGetTeam(teamIdParam);
      state.teamName=team.name;state.loading=false;
      saveMyTeamContext(teamIdParam,team.name);
      const savedName=getTeamMembership(teamIdParam);
      if(savedName){
        loadMyResult();state.userName=savedName;
        state.screen="team";
      }
      render();
    }catch(e){
      state.loading=false;
      state.error={message:'링크가 올바르지 않거나, 팀이 삭제되었을 수 있어요.'};
      render();
    }
  } else if(parseResultParam()){
    // Individual result sharing link (?r=...)
    state.screen="result";render();
  } else if(parseTeamHash()){
    loadMyResult();state.screen="team";render();
  } else {
    const hasResult=loadMyResult();loadTeam();
    const savedTeam=loadMyTeamContext();
    if(savedTeam&&sb){
      state.mode="team";state.teamId=savedTeam.teamId;state.teamName=savedTeam.teamName||'';
      const savedName=getTeamMembership(savedTeam.teamId);
      if(savedName)state.userName=savedName;
      if(hasResult)state.screen="result";
      render();
      // If teamName missing (fallback recovery), fetch from Supabase
      if(!savedTeam.teamName){
        try{
          const team=await sbGetTeam(savedTeam.teamId);
          state.teamName=team.name;
          saveMyTeamContext(savedTeam.teamId,team.name);
          render();
        }catch(e){/* team may have been deleted */}
      }
    } else {
      render();
    }
  }
})();
</script>
</body>
</html>
